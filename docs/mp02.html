<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>YIMBY by Numbers: Identifying America‚Äôs Most Housing-Friendly Cities ‚Äì STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-f93c2b1f3f0577f377aefa4848a86a36.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>


</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mp01.html"> 
<span class="menu-text">Mini-Project 01</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./mp02.html" aria-current="page"> 
<span class="menu-text">Mini-Project 02</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mp03.html"> 
<span class="menu-text">Mini-Project 03</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mp04.html"> 
<span class="menu-text">Mini-Project 04</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./summary_report.html"> 
<span class="menu-text">Final Project - Group Summary</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">CONTENT</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-acquisition" id="toc-data-acquisition" class="nav-link" data-scroll-target="#data-acquisition">üß† Data Acquisition</a>
  <ul class="collapse">
  <li><a href="#us-census-bureau-acs" id="toc-us-census-bureau-acs" class="nav-link" data-scroll-target="#us-census-bureau-acs">üóÇÔ∏è US Census Bureau ACS</a></li>
  <li><a href="#building-permits-survey-bps" id="toc-building-permits-survey-bps" class="nav-link" data-scroll-target="#building-permits-survey-bps">üèóÔ∏è Building Permits Survey (BPS)</a></li>
  <li><a href="#bureau-of-labor-statistics-bls-data" id="toc-bureau-of-labor-statistics-bls-data" class="nav-link" data-scroll-target="#bureau-of-labor-statistics-bls-data">üíº Bureau of Labor Statistics (BLS) Data</a></li>
  </ul></li>
  <li><a href="#data-integration" id="toc-data-integration" class="nav-link" data-scroll-target="#data-integration">üîó Data Integration</a>
  <ul class="collapse">
  <li><a href="#relationship-diagram" id="toc-relationship-diagram" class="nav-link" data-scroll-target="#relationship-diagram">Relationship diagram</a></li>
  <li><a href="#what-the-arrows-mean-cardinality" id="toc-what-the-arrows-mean-cardinality" class="nav-link" data-scroll-target="#what-the-arrows-mean-cardinality">üß≠ What the Arrows Mean (Cardinality)</a></li>
  </ul></li>
  <li><a href="#initial-exploration" id="toc-initial-exploration" class="nav-link" data-scroll-target="#initial-exploration">üëÄ Initial Exploration</a>
  <ul class="collapse">
  <li><a href="#q1-which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive" id="toc-q1-which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive" class="nav-link" data-scroll-target="#q1-which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive">Q1: Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</a></li>
  <li><a href="#q2-in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units" id="toc-q2-in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units" class="nav-link" data-scroll-target="#q2-in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units">Q2: In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</a></li>
  <li><a href="#q3-which-state-not-cbsa-had-the-highest-average-individual-income-in-2015" id="toc-q3-which-state-not-cbsa-had-the-highest-average-individual-income-in-2015" class="nav-link" data-scroll-target="#q3-which-state-not-cbsa-had-the-highest-average-individual-income-in-2015">Q3: Which state (not CBSA) had the highest average individual income in 2015?</a></li>
  <li><a href="#q4-data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country" id="toc-q4-data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country" class="nav-link" data-scroll-target="#q4-data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country">Q4: Data scientists and business analysts are recorded under NAICS code 5182. What is the last year in which the NYC CBSA had the most data scientists in the country?</a></li>
  <li><a href="#q4-what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak" id="toc-q4-what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak" class="nav-link" data-scroll-target="#q4-what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak">Q4: What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</a></li>
  </ul></li>
  <li><a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations">üìä Visualizations</a>
  <ul class="collapse">
  <li><a href="#the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009." id="toc-the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009." class="nav-link" data-scroll-target="#the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009.">1) The relationship between monthly rent and average household income per CBSA in 2009.</a></li>
  <li><a href="#the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time." id="toc-the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time." class="nav-link" data-scroll-target="#the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time.">2) The relationship between total employment and total employment in the health care and social services sector (NAICS 62) across different CBSAs. Design your visualization so that it is possible to see the evolution of this relationship over time.</a></li>
  <li><a href="#the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas." id="toc-the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas." class="nav-link" data-scroll-target="#the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas.">3) The evolution of average household size over time. Use different lines to represent different CBSAs.</a></li>
  </ul></li>
  <li><a href="#building-indices-of-housing-affordability-and-housing-stock-growth" id="toc-building-indices-of-housing-affordability-and-housing-stock-growth" class="nav-link" data-scroll-target="#building-indices-of-housing-affordability-and-housing-stock-growth">Building Indices of Housing Affordability and Housing Stock Growth</a>
  <ul class="collapse">
  <li><a href="#rent-burden" id="toc-rent-burden" class="nav-link" data-scroll-target="#rent-burden">Rent Burden</a></li>
  <li><a href="#housing-growth" id="toc-housing-growth" class="nav-link" data-scroll-target="#housing-growth">Housing Growth</a></li>
  <li><a href="#visualization-the-relationships-between-rent-burden-and-housing-growth" id="toc-visualization-the-relationships-between-rent-burden-and-housing-growth" class="nav-link" data-scroll-target="#visualization-the-relationships-between-rent-burden-and-housing-growth">Visualization: The Relationships between Rent Burden and Housing Growth</a></li>
  </ul></li>
  <li><a href="#policy-brief" id="toc-policy-brief" class="nav-link" data-scroll-target="#policy-brief">Policy Brief</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">YIMBY by Numbers: Identifying America‚Äôs Most Housing-Friendly Cities</h1>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<p><img src="figs/intro_header.jpg" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Housing affordability sits at the heart of America‚Äôs urban challenge‚Äîespecially in large metropolitan regions where zoning rules, construction rates, and income levels all determine who can actually afford a home. In this mini-project, we take a fresh look at the ‚ÄúYes-In-My-Backyard‚Äù (YIMBY) approach, which argues that more permissive zoning and higher housing supply lead to greater affordability and more dynamic cities.</p>
<p>By pulling together data from the U.S. Census Bureau, the Bureau of Labor Statistics, and related sources, we build a transparent, data-driven index to identify which U.S. metro areas are most aligned with YIMBY-friendly conditions: steady housing stock growth, rising incomes, and favorable industry dynamics. The goal: highlight the cities where policy reform and development activity could reduce housing costs, bolster diversity, and improve urban outcomes.</p>
<p>As you explore the sections ahead‚ÄîData Acquisition, Relationship Diagrams, Initial Visualizations and Policy Brief‚Äîyou‚Äôll see how each piece of the data puzzle fits together and supports a strategic narrative: in which American metros are the forces of supply, affordability, and economic vitality converging?</p>
</section>
<section id="data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition">üß† Data Acquisition</h2>
<section id="us-census-bureau-acs" class="level3">
<h3 class="anchored" data-anchor-id="us-census-bureau-acs">üóÇÔ∏è US Census Bureau ACS</h3>
<p>This project draws heavily from the <strong>U.S. Census Bureau‚Äôs American Community Survey (ACS)</strong>, which provides annual demographic and housing data across metropolitan regions.</p>
<p>Four essential variables were retrieved at the <strong>Core-Based Statistical Area (CBSA)</strong> level between <strong>2009 and 2023</strong>, offering a consistent view of economic and housing trends across time:</p>
<ul>
<li><strong>Household Income (B19013_001):</strong> Median household income over the past 12 months ‚Äî a key measure of local purchasing power.<br>
</li>
<li><strong>Monthly Rent (B25064_001):</strong> Median gross rent per month ‚Äî reflecting affordability pressures for renters.<br>
</li>
<li><strong>Population (B01003_001):</strong> Total population count, representing the overall size and growth of each CBSA.<br>
</li>
<li><strong>Households (B11001_001):</strong> Total number of occupied housing units, used to calculate household formation rates.</li>
</ul>
<p>Together, these variables paint a detailed picture of how American metropolitan areas have evolved economically and demographically over the last decade.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>library <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Mask base::library() to automatically install packages if needed</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Masking is important here so downlit picks up packages and links</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="do">## to documentation</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>       ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      }) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(INCOME)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,279
Columns: 4
$ GEOID            &lt;dbl&gt; 10140, 10180, 10300, 10380, 10420, 10500, 10540, 1058‚Ä¶
$ NAME             &lt;chr&gt; "Aberdeen, WA Micro Area", "Abilene, TX Metro Area", ‚Ä¶
$ household_income &lt;dbl&gt; 36345, 42931, 45640, 13470, 47482, 36218, 47669, 5767‚Ä¶
$ year             &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009,‚Ä¶</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(RENT)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,279
Columns: 4
$ GEOID        &lt;dbl&gt; 10140, 10180, 10300, 10380, 10420, 10500, 10540, 10580, 1‚Ä¶
$ NAME         &lt;chr&gt; "Aberdeen, WA Micro Area", "Abilene, TX Metro Area", "Adr‚Ä¶
$ monthly_rent &lt;dbl&gt; 650, 712, 645, 363, 723, 624, 761, 833, 579, 726, 668, 65‚Ä¶
$ year         &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 200‚Ä¶</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(POPULATION)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,279
Columns: 4
$ GEOID      &lt;dbl&gt; 10140, 10180, 10300, 10380, 10420, 10500, 10540, 10580, 107‚Ä¶
$ NAME       &lt;chr&gt; "Aberdeen, WA Micro Area", "Abilene, TX Metro Area", "Adria‚Ä¶
$ population &lt;dbl&gt; 71797, 160266, 99837, 342495, 699935, 164238, 116584, 85759‚Ä¶
$ year       &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009,‚Ä¶</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HOUSEHOLDS)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,279
Columns: 4
$ GEOID      &lt;dbl&gt; 10140, 10180, 10300, 10380, 10420, 10500, 10540, 10580, 107‚Ä¶
$ NAME       &lt;chr&gt; "Aberdeen, WA Micro Area", "Abilene, TX Metro Area", "Adria‚Ä¶
$ households &lt;dbl&gt; 27759, 58052, 36835, 91805, 281769, 60101, 43953, 336492, 3‚Ä¶
$ year       &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009,‚Ä¶</code></pre>
</div>
</div>
</section>
<section id="building-permits-survey-bps" class="level3">
<h3 class="anchored" data-anchor-id="building-permits-survey-bps">üèóÔ∏è Building Permits Survey (BPS)</h3>
<p>To capture <strong>new housing supply</strong>, data were gathered from the <strong>U.S. Census Bureau‚Äôs Building Permits Survey (BPS)</strong>, covering the years <strong>2009‚Äì2023</strong>. This dataset reports the <strong>annual number of newly permitted housing units per CBSA</strong>, serving as a direct indicator of construction activity and local development intensity.</p>
<p>Older data (2009‚Äì2018) were obtained through <strong>archived text files</strong>, while more recent years (2019‚Äì2023) were integrated from <strong>manually processed Excel tables</strong>.</p>
<p>By combining this permit data with demographic and economic information, the project quantifies how actively different regions are responding to <strong>housing demand through new construction</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year =</span> yy)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>            current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(...){</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                             <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span>  <span class="co"># Add dplyr:: here</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(PERMITS)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,658
Columns: 3
$ CBSA                        &lt;dbl&gt; 10180, 10420, 10500, 10580, 10740, 10780, ‚Ä¶
$ new_housing_units_permitted &lt;dbl&gt; 214, 741, 213, 1380, 1692, 396, 1648, 125,‚Ä¶
$ year                        &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, ‚Ä¶</code></pre>
</div>
</div>
</section>
<section id="bureau-of-labor-statistics-bls-data" class="level3">
<h3 class="anchored" data-anchor-id="bureau-of-labor-statistics-bls-data">üíº Bureau of Labor Statistics (BLS) Data</h3>
<p>Labor market information was sourced from the <strong>Bureau of Labor Statistics (BLS)</strong>, specifically the <strong>Quarterly Census of Employment and Wages (QCEW)</strong> and <strong>NAICS (North American Industry Classification System)</strong> codes. This dataset provides detailed insights into the structure and diversity of regional economies, which are closely tied to housing demand and affordability trends.</p>
<p>The table includes: - <strong>Industry-level employment and average wage data</strong> for each geographic area.<br>
- <strong>Hierarchical industry classifications</strong> from Level 1 (broad sectors like ‚ÄúAgriculture‚Äù or ‚ÄúManufacturing‚Äù) to Level 4 (detailed sub-industries such as ‚ÄúSoybean Farming‚Äù or ‚ÄúDry Pea and Bean Farming‚Äù).</p>
<p>By linking employment and wage data with housing and income indicators, this dataset adds an <strong>economic context</strong> to housing affordability ‚Äî showing how regional job composition and industry strength may influence development and cost-of-living dynamics.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(dplyr)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(tidyr)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(readr)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_perform</span>()</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(Code, title) <span class="sc">|&gt;</span>  <span class="co"># Keep both Code and title columns</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># These were looked up manually on bls.gov after finding </span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># they were presented as ranges. Since there are only three</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># it was easier to manually handle than to special-case everything else</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        naics_missing <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span>Code, <span class="sc">~</span>title, <span class="sc">~</span>depth, </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"31"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"32"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">"33"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">"44"</span>, <span class="st">"Retail"</span>, <span class="dv">1</span>, </span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">"45"</span>, <span class="st">"Retail"</span>, <span class="dv">1</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">"48"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="dv">1</span>, </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">"49"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="dv">1</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(naics_table, naics_missing)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                   level1_code,  level2_code,  level3_code,  level4_code) <span class="sc">|&gt;</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>            <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"code"</span>), as.integer))</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(INDUSTRY_CODES)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 798
Columns: 8
$ level1_title &lt;chr&gt; "Agriculture, forestry, fishing and hunting", "Agricultur‚Ä¶
$ level2_title &lt;chr&gt; "Crop production", "Crop production", "Crop production", ‚Ä¶
$ level3_title &lt;chr&gt; "Oilseed and grain farming", "Oilseed and grain farming",‚Ä¶
$ level4_title &lt;chr&gt; "Soybean farming", "Oilseed (except soybean) farming", "D‚Ä¶
$ level1_code  &lt;dbl&gt; 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 1‚Ä¶
$ level2_code  &lt;dbl&gt; 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 11‚Ä¶
$ level3_code  &lt;dbl&gt; 1111, 1111, 1111, 1111, 1111, 1111, 1111, 1112, 1113, 111‚Ä¶
$ level4_code  &lt;dbl&gt; 11111, 11112, 11113, 11114, 11115, 11116, 11119, 11121, 1‚Ä¶</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span>  <span class="co"># FIXED: Added opening parenthesis</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">" appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(area_fips,  <span class="co"># FIXED: Added dplyr::</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>                       industry_code, </span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>                       annual_avg_emplvl, </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                       total_annual_wages, </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                       YEAR) <span class="sc">|&gt;</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>                       <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>area_fips,  <span class="co"># FIXED: Added dplyr::</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>industry_code, </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, <span class="fu">paste</span>(YEARS_DIFF, <span class="at">collapse=</span><span class="st">", "</span>), </span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>             <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    ALL_DATA</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(WAGES)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,442,181
Columns: 6
$ YEAR        &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009‚Ä¶
$ FIPS        &lt;chr&gt; "C1018", "C1018", "C1018", "C1018", "C1018", "C1018", "C10‚Ä¶
$ INDUSTRY    &lt;dbl&gt; 101, 1011, 1012, 1013, 102, 1021, 1022, 1023, 1024, 1025, ‚Ä¶
$ EMPLOYMENT  &lt;dbl&gt; 8050, 1769, 3328, 2952, 42334, 11993, 0, 3575, 4697, 11950‚Ä¶
$ TOTAL_WAGES &lt;dbl&gt; 342280951, 86660038, 151822573, 103798340, 1284997543, 368‚Ä¶
$ AVG_WAGE    &lt;dbl&gt; 42519.37, 48988.15, 45619.76, 35162.04, 30353.79, 30764.23‚Ä¶</code></pre>
</div>
</div>
</section>
</section>
<section id="data-integration" class="level2">
<h2 class="anchored" data-anchor-id="data-integration">üîó Data Integration</h2>
<p>All datasets ‚Äî including ACS demographic indicators, Building Permits Survey data, and BLS industry information ‚Äî were programmatically stored in the <code>data/mp02/</code> directory and exported as <code>.csv</code> files for reproducibility.</p>
<p>Using consistent <strong>geographic identifiers</strong> (such as <code>GEOID</code> and <code>CBSA</code>) and <strong>temporal alignment</strong> via the <code>year</code> variable, these data sources were merged into a unified analytical dataset suitable for visualization and statistical modeling.</p>
<p>This integration step enables direct comparison across housing, income, and employment metrics over time. By linking multiple dimensions of local economies ‚Äî <strong>affordability</strong>, <strong>construction activity</strong>, and <strong>labor market conditions</strong> ‚Äî the combined dataset forms a solid foundation for identifying metropolitan areas that embody YIMBY-friendly dynamics.</p>
<p>In short, this multi-source framework ensures that every variable shares a common spatial and temporal reference, allowing for consistent and meaningful exploration of housing affordability patterns across the United States.</p>
<section id="relationship-diagram" class="level3">
<h3 class="anchored" data-anchor-id="relationship-diagram">Relationship diagram</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># // ---------- Core ACS tables (CBSA level) ----------</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Table INCOME {</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   GEOID int [note: 'CBSA code (e.g., 10140)']</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   NAME varchar</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   household_income numeric</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   year int</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   Note: 'ACS 1-year, 2009‚Äì2023 (no 2020)'</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   Indexes {</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     (GEOID, year) [pk]</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Table RENT {</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   GEOID int</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   NAME varchar</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   monthly_rent numeric</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   year int</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   Indexes { (GEOID, year) [pk] }</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Table POPULATION {</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   GEOID int</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   NAME varchar</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   population int</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   year int</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   Indexes { (GEOID, year) [pk] }</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Table HOUSEHOLDS {</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   GEOID int</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   NAME varchar</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   households int</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   year int</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   Indexes { (GEOID, year) [pk] }</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="co"># // ---------- Building Permits (CBSA level) ----------</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Table PERMITS {</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   CBSA int [note: 'CBSA code (same domain as GEOID)']</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   new_housing_units_permitted int</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   year int</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   Indexes { (CBSA, year) [pk] }</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="co"># // ---------- BLS QCEW wages (metro areas) ----------</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Table INDUSTRY_CODES {</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   level1_code int</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   level1_title varchar</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   level2_code int</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   level2_title varchar</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   level3_code int</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   level3_title varchar</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   level4_code int [pk]   // NAICS 4/5-digit rolled to level 4</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   level4_title varchar</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Table WAGES {</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   YEAR int</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   FIPS varchar [note: 'BLS area_fips; CBSA rows start with C (e.g., C1018)']</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   INDUSTRY int           // NAICS (level4_code)</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   EMPLOYMENT int</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   TOTAL_WAGES float</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a><span class="co">#   AVG_WAGE float</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a><span class="co">#   Indexes { (FIPS, INDUSTRY, YEAR) [pk] }</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="co"># // ---------- Minimal crosswalk to link BLS to ACS ----------</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Table BLS_CBSA_XW {</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   FIPS varchar  [pk, note: 'e.g., C1018']</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   CBSA int      [note: 'derived; example: C1018 -&gt; 10180']</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a><span class="co"># // ---------- Relationships ----------</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a><span class="co"># // ACS tables are different measures of the SAME CBSA‚Äìyear.</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a><span class="co"># // Use GEOID + year as the composite key across them.</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: RENT.(GEOID, year) &gt; INCOME.(GEOID, year)</span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: POPULATION.(GEOID, year) &gt; INCOME.(GEOID, year)</span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: HOUSEHOLDS.(GEOID, year) &gt; INCOME.(GEOID, year)</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a><span class="co"># // Permits are also CBSA‚Äìyear; join by CBSA = GEOID + year.</span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: PERMITS.(CBSA, year) &gt; INCOME.(GEOID, year)</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a><span class="co"># // WAGES maps to industry codes (many wages rows per code).</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: WAGES.INDUSTRY &gt; INDUSTRY_CODES.level4_code</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a><span class="co"># // Bridge wages geography to CBSA via crosswalk, then into ACS.</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: WAGES.FIPS &gt; BLS_CBSA_XW.FIPS</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: BLS_CBSA_XW.CBSA &gt; INCOME.GEOID</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><img src="diagram.png" class="img-fluid"></p>
</section>
<section id="what-the-arrows-mean-cardinality" class="level3">
<h3 class="anchored" data-anchor-id="what-the-arrows-mean-cardinality">üß≠ What the Arrows Mean (Cardinality)</h3>
<section id="income-rent-population-households" class="level4">
<h4 class="anchored" data-anchor-id="income-rent-population-households"><strong>INCOME ‚áÑ RENT / POPULATION / HOUSEHOLDS</strong></h4>
<p><strong>1-to-1 per (<code>GEOID</code>, <code>year</code>)</strong><br>
These tables represent different measures for the same metropolitan area and year. Each combination of <code>GEOID</code> and <code>year</code> identifies a single observation across income, rent, population, and household data.</p>
</section>
<section id="permits-acs-tables" class="level4">
<h4 class="anchored" data-anchor-id="permits-acs-tables"><strong>PERMITS ‚Üí (ACS Tables)</strong></h4>
<p><strong>1-to-1 per (<code>CBSA</code>, <code>year</code>) ‚Üí (<code>GEOID</code>, <code>year</code>)</strong><br>
Building permit data align directly with ACS data at the metropolitan level. Because <code>CBSA</code> and <code>GEOID</code> represent equivalent geographic identifiers in the ACS, this relationship ensures a one-to-one match for each metro-year.</p>
</section>
<section id="industry_codes-wages" class="level4">
<h4 class="anchored" data-anchor-id="industry_codes-wages"><strong>INDUSTRY_CODES ‚Üí WAGES</strong></h4>
<p><strong>1-to-many</strong><br>
Each industry code (NAICS Level 4) may appear in many wage records across years and geographic areas. This reflects how the same industry classification is observed repeatedly over time and across different regions.</p>
</section>
<section id="bls_cbsa_xw-income" class="level4">
<h4 class="anchored" data-anchor-id="bls_cbsa_xw-income"><strong>BLS_CBSA_XW ‚Üí INCOME</strong></h4>
<p><strong>many-to-1</strong><br>
Multiple BLS <code>FIPS</code> metro entries can correspond to a single CBSA region. The crosswalk table connects these wage-area identifiers (<code>FIPS</code>) to ACS regions (<code>GEOID</code>), allowing economic data to integrate with demographic measures.</p>
</section>
<section id="why-the-crosswalk" class="level4">
<h4 class="anchored" data-anchor-id="why-the-crosswalk">üí° <strong>Why the Crosswalk?</strong></h4>
<p>BLS <code>area_fips</code> identifiers such as <strong>C1018</strong> represent metropolitan regions that correspond to CBSA codes (e.g., <strong>10180</strong>). Rather than hard-coding this conversion, the project includes a small <strong>crosswalk table</strong> (<code>BLS_CBSA_XW</code>) to make this mapping explicit and maintainable.</p>
<p>In R, this mapping can also be computed directly when needed:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>CBSA_codes <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(WAGES<span class="sc">$</span>FIPS, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>() <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Display only the first 10 rows with a header</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(CBSA_codes, <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 10180 10180 10180 10180 10180 10180 10180 10180 10180 10180</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="initial-exploration" class="level2">
<h2 class="anchored" data-anchor-id="initial-exploration">üëÄ Initial Exploration</h2>
<section id="q1-which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive" class="level3">
<h3 class="anchored" data-anchor-id="q1-which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive">Q1: Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Findings">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Findings
</div>
</div>
<div class="callout-body-container callout-body">
<p>It seems that <strong>Houston-Sugar Land-Baytown, TX Metro Area</strong> had the highest total number of building permits, with <strong>482,075</strong> issued. This total likely represents the broader Houston metropolitan area, as seen in rows 2 and 3. Both list different areas within Houston, TX that share same total permit counts and identical CBSA codes. A similar pattern appears for Atlanta, GA and the New York‚ÄìNewark‚ÄìJersey City, NY‚ÄìNJ‚ÄìPA Metro Area.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># one name per CBSA</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cbsa_names <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(GEOID, NAME)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>top10_permits <span class="ot">&lt;-</span> PERMITS <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_permits_2010_2019 =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(total_permits_2010_2019)) <span class="sc">%&gt;%</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(cbsa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span> <span class="ot">=</span> <span class="st">"GEOID"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">transmute</span>(</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> CBSA,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Permits (2010‚Äì2019)</span><span class="st">`</span> <span class="ot">=</span> total_permits_2010_2019</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    top10_permits,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">rownames =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">ordering =</span> <span class="cn">TRUE</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">'cell-border stripe hover'</span>,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Top 10 CBSAs by Total Housing Permits (2010‚Äì2019)'</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-4a08214b6fc867a5b6f0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4a08214b6fc867a5b6f0">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold;\">Top 10 CBSAs by Total Housing Permits (2010‚Äì2019)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21"],["Houston-Sugar Land-Baytown, TX Metro Area","Houston-The Woodlands-Sugar Land, TX Metro Area","Houston-Pasadena-The Woodlands, TX Metro Area","Dallas-Fort Worth-Arlington, TX Metro Area","New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ Metro Area","Atlanta-Sandy Springs-Marietta, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Atlanta-Sandy Springs-Alpharetta, GA Metro Area","Washington-Arlington-Alexandria, DC-VA-MD-WV Metro Area","Phoenix-Mesa-Scottsdale, AZ Metro Area","Phoenix-Mesa-Glendale, AZ Metro Area","Phoenix-Mesa-Chandler, AZ Metro Area","Seattle-Tacoma-Bellevue, WA Metro Area","Austin-Round Rock, TX Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Austin-Round Rock-Georgetown, TX Metro Area","Los Angeles-Long Beach-Anaheim, CA Metro Area","Orlando-Kissimmee, FL Metro Area","Orlando-Kissimmee-Sanford, FL Metro Area"],[26420,26420,26420,19100,35620,35620,35620,12060,12060,12060,47900,38060,38060,38060,42660,12420,12420,12420,31080,36740,36740],[482075,482075,482075,460826,446020,446020,446020,254377,254377,254377,232483,219939,219939,219939,213022,212392,212392,212392,184260,171588,171588]],"container":"<table class=\"cell-border stripe hover\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA Name<\/th>\n      <th>CBSA Code<\/th>\n      <th>Total Permits (2010‚Äì2019)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"t","ordering":true,"autoWidth":true,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"CBSA Name","targets":1},{"name":"CBSA Code","targets":2},{"name":"Total Permits (2010‚Äì2019)","targets":3}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="q2-in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units" class="level3">
<h3 class="anchored" data-anchor-id="q2-in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units">Q2: In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Findings">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Findings
</div>
</div>
<div class="callout-body-container callout-body">
<p>Albuquerque, NM (CBSA 10740) recorded its highest number of new housing permits in <strong>2021</strong>, with <strong>4,021</strong> units approved. This represented a massive rebound in local housing development compared to <strong>2020</strong>, a year when construction activity slowed significantly due to COVID-19 disruptions and supply chain constraints.</p>
<p>Following the pandemic downturn, 2021 marked a surge in building demand reflecting pent up household formation and increased migration to affordable metros. Even in <strong>2022</strong>, Albuquerque continued to show strong momentum with <strong>2,852</strong> new permits, which remained notably higher than pre-pandemic levels in <strong>2019</strong>.</p>
<p>Overall, the post-COVID recovery period clearly reignited residential construction in the Albuquerque metro area.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>top5_albuquerque <span class="ot">&lt;-</span> PERMITS <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="dv">10740</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">New Housing Units</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">New Housing Units</span><span class="st">`</span>)) </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  top5_albuquerque,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">pageLength =</span> <span class="dv">5</span>, <span class="at">ordering =</span> <span class="cn">TRUE</span>), </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Top 5 Years for New Housing Permits in Albuquerque, NM (CBSA 10740)'</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-731bb01d4d0582bdd1be" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-731bb01d4d0582bdd1be">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold;\">Top 5 Years for New Housing Permits in Albuquerque, NM (CBSA 10740)<\/caption>","data":[[2021,2022,2023,2013,2014,2016,2015,2017,2018,2019,2012,2020,2010,2009,2011],[4021,2852,2834,2606,2543,2465,2295,2256,2186,2148,2084,2014,1764,1692,1634]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>year<\/th>\n      <th>New Housing Units<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","pageLength":5,"ordering":true,"columnDefs":[{"className":"dt-right","targets":[0,1]},{"name":"year","targets":0},{"name":"New Housing Units","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="q3-which-state-not-cbsa-had-the-highest-average-individual-income-in-2015" class="level3">
<h3 class="anchored" data-anchor-id="q3-which-state-not-cbsa-had-the-highest-average-individual-income-in-2015">Q3: Which state (not CBSA) had the highest average individual income in 2015?</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Findings">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Findings
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>District of Columbia</strong> recorded the highest average individual income in 2015 at <strong>$33,233</strong>, followed by Massachusetts <strong>$27,621</strong> and Connecticut <strong>$27,194</strong>.</p>
<p>This reflects D.C.‚Äôs concentration of high-wage federal and professional jobs, an educated workforce, and a higher cost of living.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>state_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">abb  =</span> <span class="fu">c</span>(state.abb, <span class="st">"DC"</span>, <span class="st">"PR"</span>),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(state.name, <span class="st">"District of Columbia"</span>, <span class="st">"Puerto Rico"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>state_income_2015 <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(HOUSEHOLDS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_extract</span>(NAME, <span class="st">", (.{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_income =</span> household_income <span class="sc">*</span> households) <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, population),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"GEOID"</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(state), <span class="sc">!</span><span class="fu">is.na</span>(total_income), <span class="sc">!</span><span class="fu">is.na</span>(population)) <span class="sc">%&gt;%</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income =</span> <span class="fu">sum</span>(total_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_population =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_individual_income =</span> total_income <span class="sc">/</span> total_population) <span class="sc">%&gt;%</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income)) <span class="sc">%&gt;%</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(state_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"abb"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  state_income_2015 <span class="sc">%&gt;%</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(name, state, avg_individual_income, total_population) <span class="sc">%&gt;%</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">State</span><span class="st">`</span> <span class="ot">=</span> name,</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Abbreviation</span><span class="st">`</span> <span class="ot">=</span> state,</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Average Individual Income</span><span class="st">`</span> <span class="ot">=</span> avg_individual_income,</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total Population</span><span class="st">`</span> <span class="ot">=</span> total_population</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,          <span class="co"># show only the table</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">paging =</span> <span class="cn">FALSE</span>,     <span class="co"># disable pagination</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">searching =</span> <span class="cn">FALSE</span>,  <span class="co"># hide search bar</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordering =</span> <span class="cn">TRUE</span>     <span class="co"># enable sorting</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Top 5 States by Average Individual Income (2015)'</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">'Average Individual Income'</span>, <span class="at">currency =</span> <span class="st">"$"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">'Total Population'</span>, <span class="at">currency =</span> <span class="st">""</span>, <span class="at">digits =</span> <span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-f1231a3f041941c62975" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f1231a3f041941c62975">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold;\">Top 5 States by Average Individual Income (2015)<\/caption>","data":[["1","2","3","4","5"],["District of Columbia","Massachusetts","Connecticut","Alaska","Vermont"],["DC","MA","CT","AK","VT"],[33232.87704752305,27620.62218449321,27194.04577279019,26426.48019006009,26380.10196112821],[6098283,6754601,3474313,499421,216661]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>State<\/th>\n      <th>Abbreviation<\/th>\n      <th>Average Individual Income<\/th>\n      <th>Total Population<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"searching":false,"ordering":true,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 2, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":[3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"State","targets":1},{"name":"Abbreviation","targets":2},{"name":"Average Individual Income","targets":3},{"name":"Total Population","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="q4-data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country" class="level3">
<h3 class="anchored" data-anchor-id="q4-data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country">Q4: Data scientists and business analysts are recorded under NAICS code 5182. What is the last year in which the NYC CBSA had the most data scientists in the country?</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Findings">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Findings
</div>
</div>
<div class="callout-body-container callout-body">
<p>The New York‚ÄìNewark‚ÄìJersey City, NY-NJ-PA Metro Area (CBSA 35620) last had the highest number of data scientists (NAICS 5182) in the country in <strong>2015</strong>, with <strong>18,922</strong> employed in the sector.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter WAGES dataset for NAICS code 5182 (data scientists &amp; related roles)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>nyc_data_scientists <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR, FIPS) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_employment =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_employment))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the CBSA with max employment each year</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>yearly_max <span class="ot">&lt;-</span> nyc_data_scientists <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(total_employment, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if NYC CBSA (FIPS code C3562) appears as the top region</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>nyc_top_years <span class="ot">&lt;-</span> yearly_max <span class="sc">%&gt;%</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FIPS <span class="sc">==</span> <span class="st">"C3562"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(YEAR))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the most recent year NYC was top</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  nyc_top_years <span class="sc">%&gt;%</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">Year =</span> YEAR, <span class="st">`</span><span class="at">NYC CBSA Code</span><span class="st">`</span> <span class="ot">=</span> FIPS, <span class="st">`</span><span class="at">Total Data Scientists</span><span class="st">`</span> <span class="ot">=</span> total_employment),  </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">paging =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">searching =</span> <span class="cn">FALSE</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Years When NYC Had the Most Data Scientists (NAICS 5182)"</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">'Total Data Scientists'</span>, <span class="at">currency =</span> <span class="st">""</span>, <span class="at">digits =</span> <span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-7035f80823c0ee77ca7c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7035f80823c0ee77ca7c">{"x":{"filter":"none","vertical":false,"caption":"<caption>Years When NYC Had the Most Data Scientists (NAICS 5182)<\/caption>","data":[["1","2","3","4","5"],[2015,2014,2013,2012,2009],["C3562","C3562","C3562","C3562","C3562"],[18922,17828,14251,14423,16349]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Year<\/th>\n      <th>NYC CBSA Code<\/th>\n      <th>Total Data Scientists<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"searching":false,"columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Year","targets":1},{"name":"NYC CBSA Code","targets":2},{"name":"Total Data Scientists","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="q4-what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak" class="level3">
<h3 class="anchored" data-anchor-id="q4-what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak">Q4: What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Findings">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Findings
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <strong>2014</strong>, New York City‚Äôs Finance and Insurance sector (NAICS 52) reached its peak share of total wages, accounting for approximately 4.6% of all wages‚Äîaround <strong>$119 billion</strong> out of <strong>$2.6 trillion</strong> total.</p>
<p>This illustrates NYC‚Äôs continued dependence on the financial industry as a major wage driver. While the sector‚Äôs wage share has declined slightly in later years, finance remains a cornerstone of the city‚Äôs economy.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate finance &amp; insurance wage share for NYC</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>nyc_finance_fraction <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FIPS <span class="sc">==</span> <span class="st">"C3562"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR, INDUSTRY) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_wages =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_total =</span> <span class="fu">sum</span>(total_wages, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">finance_fraction =</span> <span class="fu">if_else</span>(INDUSTRY <span class="sc">==</span> <span class="dv">52</span>, total_wages <span class="sc">/</span> year_total, <span class="cn">NA_real_</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">52</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(finance_fraction))</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display top 5 years in a clean table</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  nyc_finance_fraction <span class="sc">|&gt;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(finance_fraction)) <span class="sc">|&gt;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Finance Share (%)</span><span class="st">`</span> <span class="ot">=</span> finance_fraction <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">Year =</span> YEAR,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Finance Wages</span><span class="st">`</span> <span class="ot">=</span> total_wages,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total NYC Wages</span><span class="st">`</span> <span class="ot">=</span> year_total,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Finance Share (%)</span><span class="st">`</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">5</span>),</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">paging =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">searching =</span> <span class="cn">FALSE</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Top 5 Years: Finance &amp; Insurance Share of Total Wages ‚Äî NYC CBSA (NAICS 52)"</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="fu">c</span>(<span class="st">'Finance Wages'</span>, <span class="st">'Total NYC Wages'</span>), <span class="at">currency =</span> <span class="st">"$"</span>, <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="st">'Finance Share (%)'</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-20aa9caa33041887f2aa" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-20aa9caa33041887f2aa">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 5 Years: Finance &amp; Insurance Share of Total Wages ‚Äî NYC CBSA (NAICS 52)<\/caption>","data":[["1","2","3","4","5"],[2014,2011,2010,2009,2021],[119105615711,108996581223,103632250413,94479998021,156065553132],[2587096519796,2452875238158,2366455158958,2194200174111,3636399927489],[4.603833478945417,4.44362515986959,4.379218850638669,4.305896933914856,4.291759879111154]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Year<\/th>\n      <th>Finance Wages<\/th>\n      <th>Total NYC Wages<\/th>\n      <th>Finance Share (%)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"searching":false,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Year","targets":1},{"name":"Finance Wages","targets":2},{"name":"Total NYC Wages","targets":3},{"name":"Finance Share (%)","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">üìä Visualizations</h2>
<section id="the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009." class="level3">
<h3 class="anchored" data-anchor-id="the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009.">1) The relationship between monthly rent and average household income per CBSA in 2009.</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Findings">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Findings
</div>
</div>
<div class="callout-body-container callout-body">
<p>The scatterplot shows a strong positive relationship between average household income and average monthly rent across CBSAs in 2009, with a <strong>correlation (r) of 0.76</strong> and an <strong>R¬≤ of 0.58</strong>. This indicates that higher-income areas tend to have higher rents, although income explains only about <strong>58% of rent variation</strong> ‚Äî suggesting that other local factors (like housing supply and demand) also play an important role.</p>
<p>Several <strong>Puerto Rico metro areas</strong> (e.g., Coamo, Guayama, Mayag√ºez) show <strong>exceptionally high rent-to-income ratios</strong>, reflecting affordability challenges despite low rent levels, due to very low household incomes. In contrast, high-income regions like Key West, FL and Miami-Fort Lauderdale, FL also appear near the upper trend line, indicating higher absolute rent burdens in wealthier markets.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)  <span class="co"># install.packages("ggrepel") if needed</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"scales"</span>)  <span class="co"># only if not installed</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
The downloaded binary packages are in
    /var/folders/mt/2l7ffl0j0772_8flg2xcf32m0000gn/T//RtmpcTgYmr/downloaded_packages</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter and join 2009 ACS data</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>rent_income_2009 <span class="ot">&lt;-</span> RENT <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, monthly_rent) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    INCOME <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, household_income),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"GEOID"</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_to_income_ratio =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display sample of joined data</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rent_income_2009)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 5
  GEOID NAME                  monthly_rent household_income rent_to_income_ratio
  &lt;dbl&gt; &lt;chr&gt;                        &lt;dbl&gt;            &lt;dbl&gt;                &lt;dbl&gt;
1 10140 Aberdeen, WA Micro A‚Ä¶          650            36345                0.215
2 10180 Abilene, TX Metro Ar‚Ä¶          712            42931                0.199
3 10300 Adrian, MI Micro Area          645            45640                0.170
4 10380 Aguadilla-Isabela-Sa‚Ä¶          363            13470                0.323
5 10420 Akron, OH Metro Area           723            47482                0.183
6 10500 Albany, GA Metro Area          624            36218                0.207</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>top_ratio <span class="ot">&lt;-</span> rent_income_2009 <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(rent_to_income_ratio, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation and R-squared</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>r_val <span class="ot">&lt;-</span> <span class="fu">cor</span>(rent_income_2009<span class="sc">$</span>household_income, rent_income_2009<span class="sc">$</span>monthly_rent, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>r2_val <span class="ot">&lt;-</span> r_val<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Format nicely for the subtitle</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>corr_text <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Correlation (r) = "</span>, <span class="fu">round</span>(r_val, <span class="dv">2</span>), </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"   |   R¬≤ = "</span>, <span class="fu">round</span>(r2_val, <span class="dv">2</span>))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with annotation</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rent_income_2009, <span class="fu">aes</span>(household_income, monthly_rent)) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> top_ratio, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">2.2</span>) <span class="sc">+</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> top_ratio,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_replace</span>(NAME, <span class="st">" Metro Area$"</span>, <span class="st">""</span>)),</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>, <span class="at">max.overlaps =</span> <span class="dv">20</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship between Monthly Rent and Household Income (2009)"</span>,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> corr_text,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Avg Household Income"</span>,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Avg Monthly Rent"</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as an interactive datatable</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  top_ratio <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(NAME, monthly_rent, household_income, rent_to_income_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Monthly Rent ($)</span><span class="st">`</span> <span class="ot">=</span> monthly_rent,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Household Income ($)</span><span class="st">`</span> <span class="ot">=</span> household_income,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent-to-Income Ratio</span><span class="st">`</span> <span class="ot">=</span> rent_to_income_ratio</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Top 10 CBSAs by Rent-to-Income Ratio (2009)"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">paging =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">searching =</span> <span class="cn">FALSE</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">'Monthly Rent ($)'</span>, <span class="at">currency =</span> <span class="st">"$"</span>, <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="st">'Household Income ($)'</span>, <span class="at">currency =</span> <span class="st">"$"</span>, <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatPercentage</span>(<span class="st">'Rent-to-Income Ratio'</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-9ae0a3785e858331ab55" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9ae0a3785e858331ab55">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 10 CBSAs by Rent-to-Income Ratio (2009)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10"],["Coamo, PR Micro Area","Aguadilla-Isabela-San Sebasti?n, PR Metro Area","Guayama, PR Metro Area","Key West, FL Micro Area","Mayag?ez, PR Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Gainesville, FL Metro Area","College Station-Bryan, TX Metro Area","Eureka-Arcata-Fortuna, CA Micro Area","Yauco, PR Metro Area"],[375,363,421,1206,353,1077,870,788,817,307],[13126,13470,16027,49721,15031,45946,37654,34137,35745,13554],[0.3428310223982934,0.3233853006681515,0.3152180695077058,0.291064137889423,0.2818175770075178,0.2812867278979672,0.2772613799330748,0.2770014939801388,0.2742761225346202,0.2718016821602479]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA Name<\/th>\n      <th>Monthly Rent ($)<\/th>\n      <th>Household Income ($)<\/th>\n      <th>Rent-to-Income Ratio<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"searching":false,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"CBSA Name","targets":1},{"name":"Monthly Rent ($)","targets":2},{"name":"Household Income ($)","targets":3},{"name":"Rent-to-Income Ratio","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time." class="level3">
<h3 class="anchored" data-anchor-id="the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time.">2) The relationship between total employment and total employment in the health care and social services sector (NAICS 62) across different CBSAs. Design your visualization so that it is possible to see the evolution of this relationship over time.</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Findings">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Findings
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Strong Positive Relationship:</strong> Across CBSAs, total employment and health care employment are closely correlated ‚Äî regions with larger overall workforces tend to have higher employment in the health care and social assistance sector.<br>
</li>
<li><strong>Gradual Growth Over Time:</strong> The average share of health care employment increased from around <strong>3.5% in 2009</strong> to approximately <strong>3.9% in 2023</strong>, showing consistent expansion across years.<br>
</li>
<li><strong>Sector Resilience:</strong> Even during periods of broader economic fluctuation, the health care sector maintained steady growth, emphasizing its structural importance and resilience in local economies.<br>
</li>
<li><strong>Implication:</strong> This trend suggests that health care continues to play a growing role in regional labor markets, likely driven by demographic changes and rising demand for medical and social services.</li>
</ul>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>employment_trend <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FIPS, YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_employment =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">healthcare_employment =</span> <span class="fu">sum</span>(EMPLOYMENT[INDUSTRY <span class="sc">==</span> <span class="dv">62</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share_healthcare =</span> healthcare_employment <span class="sc">/</span> total_employment)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>employment_trend <span class="ot">&lt;-</span> employment_trend <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_employment),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>         total_employment <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(healthcare_employment),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>         healthcare_employment <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(employment_trend, <span class="fu">aes</span>(<span class="at">x =</span> total_employment, <span class="at">y =</span> healthcare_employment, <span class="at">color =</span> YEAR)) <span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>())) <span class="sc">+</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>())) <span class="sc">+</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">end =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Health Care &amp; Social Assistance Employment vs Total Employment (2009‚Äì2023)"</span>,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Total Employment (All Industries)"</span>,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Health Care &amp; Social Assistance Employment"</span>,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Year"</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(employment_trend, <span class="fu">aes</span>(<span class="at">x =</span> YEAR, <span class="at">y =</span> share_healthcare)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="at">color =</span> <span class="st">"#0073C2FF"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_se, <span class="at">geom =</span> <span class="st">"ribbon"</span>, <span class="at">alpha =</span> <span class="fl">0.15</span>, <span class="at">fill =</span> <span class="st">"#0073C2FF"</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Share of Health Care Employment over Time (2009‚Äì2023)"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Health Care Share of Total Employment"</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">+</span>  <span class="co"># two decimals</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas." class="level3">
<h3 class="anchored" data-anchor-id="the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas.">3) The evolution of average household size over time. Use different lines to represent different CBSAs.</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Findings">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Findings
</div>
</div>
<div class="callout-body-container callout-body">
<p>Across all CBSAs, average household size has gradually declined between 2009 and 2023. The national median (blue line) remained stable around <strong>2.6‚Äì2.8</strong>, while major metros‚Äîespecially <strong>Los Angeles</strong> and <strong>Miami</strong>‚Äîconsistently reported larger household sizes above the national trend. In contrast, <strong>New York</strong> and <strong>Chicago</strong> trended lower, reflecting smaller and denser urban households and a rise in single-person living arrangements.</p>
<p>All four major metros experienced steady growth in total household counts from 2009 to 2023.<br>
- <strong>New York</strong> maintained the largest number of households, surpassing <strong>7 million</strong> by 2023.<br>
- <strong>Los Angeles</strong> showed strong growth, approaching <strong>4.5 million households</strong>, followed by <strong>Chicago</strong> and <strong>Miami</strong>. - <strong>Miami</strong> displayed the steepest growth curve, reflecting post-2015 migration and housing expansion.<br>
This trend highlights continued urban concentration and regional population growth in Sun Belt metros.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Compute household size per CBSA-year</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>hh_size <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hh_size =</span> population <span class="sc">/</span> households) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(hh_size), hh_size <span class="sc">&gt;</span> <span class="dv">0</span>, hh_size <span class="sc">&lt;</span> <span class="dv">10</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Tag the four city families</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>hh_size4 <span class="ot">&lt;-</span> hh_size <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"New York|Northern New Jersey|Jersey City"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Los Angeles|Long Beach|Anaheim|Santa Ana"</span>,   <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Los Angeles"</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Chicago|Naperville|Joliet|Elgin"</span>,            <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Chicago"</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Miami|Fort Lauderdale|Pompano Beach"</span>,        <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Miami"</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Plot: all CBSAs gray; 4 cities colored; national median in blue</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hh_size4, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> hh_size, <span class="at">group =</span> NAME)) <span class="sc">+</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># all CBSAs in gray</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.08</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># highlighted CBSAs belonging to the 4 city families</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(hh_size4, <span class="sc">!</span><span class="fu">is.na</span>(city)),</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> city), <span class="at">linewidth =</span> <span class="fl">1.05</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># national median line (blue)</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> hh_size4, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">fun =</span> median,</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"line"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#2C7FB8"</span>, <span class="at">alpha =</span> <span class="fl">0.9</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Highlighted Cities"</span>,</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"New York"</span> <span class="ot">=</span> <span class="st">"#6A5ACD"</span>, <span class="st">"Los Angeles"</span> <span class="ot">=</span> <span class="st">"#1B9E77"</span>,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Chicago"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Miami"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Average Household Size"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">4.5</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">1.5</span>, <span class="fl">4.5</span>, <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Year"</span>, <span class="at">breaks =</span> pretty) <span class="sc">+</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Gray = all CBSAs; colored = CBSA lines within each city family; blue = national median"</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>city_households <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">city =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"New York|Northern New Jersey|Jersey City"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Los Angeles|Long Beach|Anaheim|Santa Ana"</span>,   <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Los Angeles"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Chicago|Naperville|Joliet|Elgin"</span>,            <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Chicago"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Miami|Fort Lauderdale|Pompano Beach"</span>,        <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Miami"</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(city))</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Sum all CBSA parts per city-year</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>city_year_hh <span class="ot">&lt;-</span> city_households <span class="sc">%&gt;%</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(city, year) <span class="sc">%&gt;%</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_households =</span> <span class="fu">sum</span>(households, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Plot</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(city_year_hh, <span class="fu">aes</span>(year, total_households, <span class="at">group =</span> city, <span class="at">color =</span> city)) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.4</span>) <span class="sc">+</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> pretty) <span class="sc">+</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> city, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Population by City (Aggregated CBSA Variants)"</span>,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Households"</span>) <span class="sc">+</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>acs_tagged <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">city =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"New York|Northern New Jersey|Jersey City"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Los Angeles|Long Beach|Anaheim|Santa Ana"</span>,   <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Los Angeles"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Chicago|Naperville|Joliet|Elgin"</span>,            <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Chicago"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME, <span class="fu">regex</span>(<span class="st">"Miami|Fort Lauderdale|Pompano Beach"</span>,        <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Miami"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(city)) <span class="sc">%&gt;%</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, households, city)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Join population to compute HH size at CBSA-year</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>cbsa_size <span class="ot">&lt;-</span> acs_tagged <span class="sc">%&gt;%</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, population),</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>, <span class="st">"year"</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(households <span class="sc">&gt;</span> <span class="dv">0</span>, population <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hh_size =</span> population <span class="sc">/</span> households)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Aggregate to city-year with a household-weighted average</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>city_year_size <span class="ot">&lt;-</span> cbsa_size <span class="sc">%&gt;%</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(city, year) <span class="sc">%&gt;%</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop  =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_hh   =</span> <span class="fu">sum</span>(households,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_hh_size =</span> total_pop <span class="sc">/</span> total_hh,</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Plot (single panel)</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(city_year_size, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_hh_size, <span class="at">color =</span> city)) <span class="sc">+</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">+</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> pretty) <span class="sc">+</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Household Size Over Time (Aggregated by City)"</span>,</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Household-weighted average across all CBSAs belonging to each metro family"</span>,</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Household Size"</span>,</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"City"</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="building-indices-of-housing-affordability-and-housing-stock-growth" class="level2">
<h2 class="anchored" data-anchor-id="building-indices-of-housing-affordability-and-housing-stock-growth">Building Indices of Housing Affordability and Housing Stock Growth</h2>
<section id="rent-burden" class="level3">
<h3 class="anchored" data-anchor-id="rent-burden">Rent Burden</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Key Takeaways">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Key Takeaways
</div>
</div>
<div class="callout-body-container callout-body">
<section id="rent-burden-across-u.s.-metropolitan-areas" class="level3">
<h3 class="anchored" data-anchor-id="rent-burden-across-u.s.-metropolitan-areas">üèôÔ∏è Rent Burden Across U.S. Metropolitan Areas</h3>
<p>The Rent Burden Index, standardized between 0 (least burdened) and 100 (most burdened), reveals notable disparities in housing affordability across U.S. metropolitan areas. Nationally, the long-term average rent-to-income ratio serves as the baseline, meaning higher index values correspond to metros where residents spend a larger portion of income on rent. <strong>In 2023, Clearlake, CA</strong> topped the list with a Rent Burden Index of <strong>72.9</strong>, indicating that residents there devote roughly 31% of their income to rent‚Äîwell above the national mean. Other high-burden areas include <strong>Aguadilla, PR, Cape Coral‚ÄìFort Myers, FL, and Miami‚ÄìFort Lauderdale‚ÄìWest Palm Beach, FL</strong>, reflecting how coastal and resort economies continue to face pressure from limited housing supply and post-pandemic migration patterns.</p>
</section>
<section id="new-yorks-rent-burden-over-time" class="level3">
<h3 class="anchored" data-anchor-id="new-yorks-rent-burden-over-time">üóΩ New York‚Äôs Rent Burden Over Time</h3>
<p>In contrast, the New York‚ÄìNewark‚ÄìJersey City metro exhibits moderate but cyclical rent burden levels. <strong>Between 2013 and 2023</strong>, its Rent Burden Index fluctuated <strong>between 35 and 41</strong>, remaining below the most heavily burdened metros yet consistently above the national average. The sharp dip in <strong>2019</strong> suggests a brief period of improved affordability‚Äîpotentially influenced by wage growth outpacing rent increases‚Äîfollowed by a rebound in <strong>2021</strong> as pandemic-era demand surged. This volatility underscores the sensitivity of high-density, supply-constrained metros like New York to broader economic cycles and short-term housing shocks.</p>
</section>
<section id="national-interpretation-and-broader-context" class="level3">
<h3 class="anchored" data-anchor-id="national-interpretation-and-broader-context">üìà National Interpretation and Broader Context</h3>
<p>Across the country, the data suggest a widening gap between high- and low-burden regions. The <strong>top 10 CBSAs in 2023</strong> all recorded <strong>rent-to-income ratios near or above 30%</strong>, a level commonly used by HUD to define housing cost stress. Meanwhile, large interior metros with slower population growth and greater housing elasticity remain well below this threshold. The Rent Burden Index thus offers a standardized lens to compare affordability dynamics across time and geography‚Äîhighlighting how the interplay between income growth, housing supply, and regional demand continues to shape access to affordable living in American cities.</p>
</section>
<section id="building-friendliness-insights" class="level3">
<h3 class="anchored" data-anchor-id="building-friendliness-insights">üèóÔ∏è Building-Friendliness Insights</h3>
<p>The Building-Friendliness Index measures how actively a metropolitan area adds new housing relative to its population size and growth rate. It standardizes both permits per 1,000 residents and permit growth versus population growth on a 0‚Äì100 scale, where 100 indicates the most construction-friendly market.</p>
<p><strong>1. Leaders in Construction Activity</strong> <strong>In 2023, Salisbury, MD Metro Area</strong> ranked first nationwide with a Building-Friendliness Index of 100, issuing nearly <strong>38 permits per 1,000 residents</strong> and posting <strong>a 13.3 percentage-point surplus</strong> in permit growth over population growth. Other highly active metros include <strong>The Villages, FL (‚âà 34 permits per 1,000) and Myrtle Beach‚ÄìConway‚ÄìNorth Myrtle Beach, SC (‚âà 33 permits per 1,000)</strong>. These regions show strong housing expansion relative to local demand, suggesting greater elasticity in housing supply.</p>
<p><strong>2. Geographic Patterns</strong> Most of the top-ranked CBSAs are located in the Southeast and coastal regions, particularly <strong>in Florida and South Carolina</strong>, where both population inflows and new construction are elevated. Their consistently positive growth differentials indicate that permitting has kept pace‚Äîor even exceeded‚Äîpopulation pressures.</p>
<p><strong>3. Broader Interpretation</strong> High building-friendliness implies a regulatory and economic environment that facilitates new development, helping stabilize housing affordability over time. Conversely, metro areas with low index values likely face supply constraints, which can magnify rent burden and affordability challenges even when population growth is modest.</p>
</section>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Join income and rent data for all years</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> RENT <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(INCOME, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rent_to_income =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Compute long-term (multi-year) national baseline</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>national_avg <span class="ot">&lt;-</span> <span class="fu">mean</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>national_sd  <span class="ot">&lt;-</span> <span class="fu">sd</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create standardized Rent Burden Index</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  - 0 = national average across all years</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  - +1 SD = more rent burdened; -1 SD = less rent burdened</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  - also create percentile-like index (0‚Äì100) for interpretability</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_z =</span> (rent_to_income <span class="sc">-</span> national_avg) <span class="sc">/</span> national_sd,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_index =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(rent_to_income,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">from =</span> <span class="fu">range</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>nyc_burden <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nyc_burden, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index)) <span class="sc">+</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#0073C2FF"</span>, <span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#0073C2FF"</span>) <span class="sc">+</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden Over Time ‚Äî New York Metro"</span>,</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Indexed to long-term national average (0 = least burdened, 100 = most burdened)"</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent Burden Index (0‚Äì100)"</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define latest_year first</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(rent_burden<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>rent_burden_rank <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_index)) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>())</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  rent_burden_rank <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(NAME, year, rent_to_income, rent_burden_index) <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Year</span><span class="st">`</span> <span class="ot">=</span> year,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent-to-Income Ratio</span><span class="st">`</span> <span class="ot">=</span> rent_to_income,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden Index (0‚Äì100)</span><span class="st">`</span> <span class="ot">=</span> rent_burden_index</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">scrollY =</span> <span class="dv">400</span>),</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"CBSAs with Highest and Lowest Rent Burden ("</span>, latest_year, <span class="st">")"</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatPercentage</span>(<span class="st">'Rent-to-Income Ratio'</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="st">'Rent Burden Index (0‚Äì100)'</span>, <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-4f5da667e2330092f2db" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4f5da667e2330092f2db">{"x":{"filter":"none","vertical":false,"caption":"<caption>CBSAs with Highest and Lowest Rent Burden (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530"],["Clearlake, CA Micro Area","Aguadilla, PR Metro Area","Cape Coral-Fort Myers, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Port St. Lucie, FL Metro Area","Ponce, PR Metro Area","Tampa-St. Petersburg-Clearwater, FL Metro Area","Key West-Key Largo, FL Micro Area","North Port-Bradenton-Sarasota, FL Metro Area","Ocala, FL Metro Area","Orlando-Kissimmee-Sanford, FL Metro Area","Salinas, CA Metro Area","Chico, CA Metro Area","Naples-Marco Island, FL Metro Area","Deltona-Daytona Beach-Ormond Beach, FL Metro Area","Merced, CA Metro Area","Guayama, PR Metro Area","Mayag√ºez, PR Metro Area","Gainesville, FL Metro Area","San Diego-Chula Vista-Carlsbad, CA Metro Area","Las Vegas-Henderson-North Las Vegas, NV Metro Area","Flagstaff, AZ Metro Area","Kahului-Wailuku, HI Metro Area","Santa Maria-Santa Barbara, CA Metro Area","Los Angeles-Long Beach-Anaheim, CA Metro Area","Panama City-Panama City Beach, FL Metro Area","Prescott Valley-Prescott, AZ Metro Area","Napa, CA Metro Area","Ukiah, CA Micro Area","Murrells Inlet, SC Micro Area","College Station-Bryan, TX Metro Area","San Luis Obispo-Paso Robles, CA Metro Area","Punta Gorda, FL Metro Area","Homosassa Springs, FL Metro Area","San Juan-Bayam√≥n-Caguas, PR Metro Area","Riverside-San Bernardino-Ontario, CA Metro Area","Hobbs, NM Micro Area","Oxnard-Thousand Oaks-Ventura, CA Metro Area","Palm Bay-Melbourne-Titusville, FL Metro Area","Sebring, FL Metro Area","Lakeland-Winter Haven, FL Metro Area","St. George, UT Metro Area","Hilton Head Island-Bluffton-Port Royal, SC Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","Arecibo, PR Metro Area","Vallejo, CA Metro Area","Ithaca, NY Metro Area","Phoenix-Mesa-Chandler, AZ Metro Area","Santa Rosa-Petaluma, CA Metro Area","Jacksonville, FL Metro Area","Truckee-Grass Valley, CA Micro Area","Eureka-Arcata, CA Micro Area","Lubbock, TX Metro Area","Boulder, CO Metro Area","Hilo-Kailua, HI Micro Area","Bellingham, WA Metro Area","Watertown-Fort Drum, NY Metro Area","Fresno, CA Metro Area","Abilene, TX Metro Area","Fayetteville, NC Metro Area","San Angelo, TX Metro Area","Medford, OR Metro Area","Clovis, NM Micro Area","Urban Honolulu, HI Metro Area","Savannah, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Corpus Christi, TX Metro Area","Hinesville, GA Metro Area","Bozeman, MT Metro Area","Wilson, NC Micro Area","Eugene-Springfield, OR Metro Area","Santa Cruz-Watsonville, CA Metro Area","Coeur d'Alene, ID Metro Area","Tallahassee, FL Metro Area","Sebastian-Vero Beach-West Vero Corridor, FL Metro Area","Reno, NV Metro Area","Modesto, CA Metro Area","Charleston-North Charleston, SC Metro Area","Fort Collins-Loveland, CO Metro Area","Albany, OR Metro Area","Lake Havasu City-Kingman, AZ Metro Area","Sherman-Denison, TX Metro Area","Lumberton, NC Micro Area","Florence, SC Metro Area","Gallup, NM Micro Area","El Paso, TX Metro Area","Olympia-Lacey-Tumwater, WA Metro Area","Bluefield, WV-VA Micro Area","Alamogordo, NM Micro Area","New Orleans-Metairie, LA Metro Area","Colorado Springs, CO Metro Area","Sierra Vista-Douglas, AZ Metro Area","Asheville, NC Metro Area","Huntsville, TX Micro Area","Sacramento-Roseville-Folsom, CA Metro Area","Clarksville, TN-KY Metro Area","LaGrange, GA-AL Micro Area","Stockton-Lodi, CA Metro Area","Bloomington, IN Metro Area","Dallas-Fort Worth-Arlington, TX Metro Area","Athens-Clarke County, GA Metro Area","Bend, OR Metro Area","Texarkana, TX-AR Metro Area","Klamath Falls, OR Micro Area","Lufkin, TX Micro Area","Granbury, TX Micro Area","San Francisco-Oakland-Fremont, CA Metro Area","Memphis, TN-MS-AR Metro Area","Shreveport-Bossier City, LA Metro Area","Corvallis, OR Metro Area","Bakersfield-Delano, CA Metro Area","Salem, OR Metro Area","Jacksonville, NC Metro Area","East Stroudsburg, PA Micro Area","Monroe, LA Metro Area","Pine Bluff, AR Micro Area","Wilmington, NC Metro Area","New York-Newark-Jersey City, NY-NJ Metro Area","Charlotte-Concord-Gastonia, NC-SC Metro Area","Nashville-Davidson--Murfreesboro--Franklin, TN Metro Area","Virginia Beach-Chesapeake-Norfolk, VA-NC Metro Area","Mobile, AL Metro Area","Palatka, FL Micro Area","Vineland, NJ Metro Area","Denver-Aurora-Centennial, CO Metro Area","Durham-Chapel Hill, NC Metro Area","Pikeville, KY Micro Area","Hanford-Corcoran, CA Metro Area","Shelton, WA Micro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Danville, VA Micro Area","San Antonio-New Braunfels, TX Metro Area","Killeen-Temple, TX Metro Area","Boise City, ID Metro Area","Grand Junction, CO Metro Area","Danville, IL Micro Area","Mount Vernon-Anacortes, WA Metro Area","Valdosta, GA Metro Area","Columbus, GA-AL Metro Area","New Haven, CT Metro Area","Grants Pass, OR Metro Area","Bremerton-Silverdale-Port Orchard, WA Metro Area","Hammond, LA Metro Area","Tucson, AZ Metro Area","Dover, DE Metro Area","San Jose-Sunnyvale-Santa Clara, CA Metro Area","Carson City, NV Metro Area","Oak Harbor, WA Micro Area","Boston-Cambridge-Newton, MA-NH Metro Area","Hot Springs, AR Metro Area","Houston-Pasadena-The Woodlands, TX Metro Area","Heber, UT Micro Area","Wildwood-The Villages, FL Metro Area","Hattiesburg, MS Metro Area","Salisbury, MD Metro Area","Rio Grande City-Roma, TX Micro Area","Scranton--Wilkes-Barre, PA Metro Area","Tyler, TX Metro Area","Blacksburg-Christiansburg-Radford, VA Metro Area","Lafayette-West Lafayette, IN Metro Area","Pueblo, CO Metro Area","Barnstable Town, MA Metro Area","Redding, CA Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Albuquerque, NM Metro Area","Waco, TX Metro Area","Seattle-Tacoma-Bellevue, WA Metro Area","New Bern, NC Micro Area","Richmond, VA Metro Area","Chattanooga, TN-GA Metro Area","Houma-Bayou Cane-Thibodaux, LA Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Portland-Vancouver-Hillsboro, OR-WA Metro Area","Spokane-Spokane Valley, WA Metro Area","Odessa, TX Metro Area","Yuba City, CA Metro Area","Pensacola-Ferry Pass-Brent, FL Metro Area","Kapaa, HI Micro Area","Beaumont-Port Arthur, TX Metro Area","Visalia, CA Metro Area","Alexandria, LA Metro Area","Gainesville, GA Metro Area","Jackson, MS Metro Area","McAllen-Edinburg-Mission, TX Metro Area","Greensboro-High Point, NC Metro Area","Columbia, SC Metro Area","Fairbanks-College, AK Metro Area","Greenville, NC Metro Area","Salt Lake City-Murray, UT Metro Area","Lawton, OK Metro Area","State College, PA Metro Area","Ann Arbor, MI Metro Area","Brownsville-Harlingen, TX Metro Area","Brunswick-St. Simons, GA Metro Area","Terre Haute, IN Metro Area","Greeley, CO Metro Area","Meridian, MS Micro Area","Gulfport-Biloxi, MS Metro Area","Pinehurst-Southern Pines, NC Metro Area","Kalispell, MT Micro Area","Show Low, AZ Micro Area","Staunton-Stuarts Draft, VA Metro Area","Macon-Bibb County, GA Metro Area","Nacogdoches, TX Micro Area","Roseburg, OR Micro Area","Baton Rouge, LA Metro Area","Statesboro, GA Micro Area","Elmira, NY Metro Area","El Centro, CA Metro Area","Springfield, MA Metro Area","Amherst Town-Northampton, MA Metro Area","Corbin, KY Micro Area","Stillwater, OK Micro Area","Portland-South Portland, ME Metro Area","Farmington, NM Metro Area","Jackson, TN Metro Area","Greenville-Anderson-Greer, SC Metro Area","Athens, TX Micro Area","Manhattan, KS Metro Area","Kiryas Joel-Poughkeepsie-Newburgh, NY Metro Area","Twin Falls, ID Metro Area","Burlington-South Burlington, VT Metro Area","Goldsboro, NC Metro Area","Thomasville, GA Micro Area","Auburn-Opelika, AL Metro Area","Yuma, AZ Metro Area","Bridgeport-Stamford-Danbury, CT Metro Area","Philadelphia-Camden-Wilmington, PA-NJ-DE-MD Metro Area","Rexburg, ID Micro Area","Knoxville, TN Metro Area","Raleigh-Cary, NC Metro Area","Forest City, NC Micro Area","Charlottesville, VA Metro Area","Bangor, ME Metro Area","Birmingham, AL Metro Area","Sumter, SC Metro Area","Lancaster, PA Metro Area","Allentown-Bethlehem-Easton, PA-NJ Metro Area","Victoria, TX Metro Area","Roanoke, VA Metro Area","Dothan, AL Metro Area","Port Angeles, WA Micro Area","Longview-Kelso, WA Metro Area","Las Cruces, NM Metro Area","Baltimore-Columbia-Towson, MD Metro Area","Lafayette, LA Metro Area","Eagle Pass, TX Metro Area","Atlantic City-Hammonton, NJ Metro Area","Traverse City, MI Metro Area","Slidell-Mandeville-Covington, LA Metro Area","Augusta-Waterville, ME Micro Area","Tuscaloosa, AL Metro Area","Laredo, TX Metro Area","Spartanburg, SC Metro Area","Johnson City, TN Metro Area","Longview, TX Metro Area","Lake City, FL Micro Area","Rifle, CO Micro Area","Tulsa, OK Metro Area","Augusta-Richmond County, GA-SC Metro Area","Muskegon-Norton Shores, MI Metro Area","Greenfield, MA Micro Area","Montgomery, AL Metro Area","Oklahoma City, OK Metro Area","Norwich-New London-Willimantic, CT Metro Area","Detroit-Warren-Dearborn, MI Metro Area","Marion-Herrin, IL Micro Area","Sevierville, TN Micro Area","Madison, WI Metro Area","Lake Charles, LA Metro Area","Columbus, OH Metro Area","Kenosha, WI Metro Area","Albany, GA Metro Area","Orangeburg, SC Micro Area","Reading, PA Metro Area","Yakima, WA Metro Area","Manchester-Nashua, NH Metro Area","Centralia, WA Micro Area","South Bend-Mishawaka, IN-MI Metro Area","Elkhart-Goshen, IN Metro Area","Jonesboro, AR Metro Area","Washington-Arlington-Alexandria, DC-VA-MD-WV Metro Area","Rome, GA Metro Area","Beckley, WV Metro Area","Chicago-Naperville-Elgin, IL-IN Metro Area","Providence-Warwick, RI-MA Metro Area","Waterbury-Shelton, CT Metro Area","Lexington-Fayette, KY Metro Area","Greenwood, SC Micro Area","Santa Fe, NM Metro Area","Richmond, IN Micro Area","Muncie, IN Metro Area","Missoula, MT Metro Area","Opelousas, LA Micro Area","Kingston, NY Metro Area","Kankakee, IL Metro Area","Seaford, DE Micro Area","Champaign-Urbana, IL Metro Area","Michigan City-La Porte, IN Metro Area","Cleveland, TN Metro Area","Lawrence, KS Metro Area","Battle Creek, MI Metro Area","Amarillo, TX Metro Area","Kalamazoo-Portage, MI Metro Area","Fayetteville-Springdale-Rogers, AR Metro Area","Burlington, NC Metro Area","Winchester, VA-WV Metro Area","Lewiston-Auburn, ME Metro Area","Louisville/Jefferson County, KY-IN Metro Area","Albany-Schenectady-Troy, NY Metro Area","New Iberia, LA Micro Area","Idaho Falls, ID Metro Area","Oxford, MS Micro Area","Springfield, MO Metro Area","Kennewick-Richland, WA Metro Area","Columbia, MO Metro Area","Pocatello, ID Metro Area","Charleston, WV Metro Area","Harrisburg-Carlisle, PA Metro Area","Little Rock-North Little Rock-Conway, AR Metro Area","Lewiston, ID-WA Metro Area","Kansas City, MO-KS Metro Area","Rochester, NY Metro Area","Altoona, PA Metro Area","Anderson Creek, NC Micro Area","Kokomo, IN Metro Area","Aberdeen, WA Micro Area","Indianapolis-Carmel-Greenwood, IN Metro Area","Grand Rapids-Wyoming-Kentwood, MI Metro Area","Saginaw, MI Metro Area","Morristown, TN Metro Area","Flint, MI Metro Area","Provo-Orem-Lehi, UT Metro Area","Portsmouth, OH Micro Area","Winston-Salem, NC Metro Area","Lebanon-Claremont, NH-VT Micro Area","Hagerstown-Martinsburg, MD-WV Metro Area","Hermiston-Pendleton, OR Micro Area","Anniston-Oxford, AL Metro Area","Worcester, MA Metro Area","Wenatchee-East Wenatchee, WA Metro Area","Joplin, MO-KS Metro Area","Youngstown-Warren, OH Metro Area","Owosso, MI Micro Area","Dayton-Kettering-Beavercreek, OH Metro Area","Morgantown, WV Metro Area","Cleveland, OH Metro Area","Somerset, KY Micro Area","Trenton-Princeton, NJ Metro Area","Muskogee, OK Micro Area","Bowling Green, KY Metro Area","Warner Robins, GA Metro Area","Jackson, MI Metro Area","Cheyenne, WY Metro Area","Ogden, UT Metro Area","Concord, NH Micro Area","Anchorage, AK Metro Area","Harrisonburg, VA Metro Area","Hartford-West Hartford-East Hartford, CT Metro Area","Fort Payne, AL Micro Area","Plattsburgh, NY Micro Area","Buffalo-Cheektowaga, NY Metro Area","Kingsport-Bristol, TN-VA Metro Area","Lebanon, PA Metro Area","Wichita Falls, TX Metro Area","Minneapolis-St. Paul-Bloomington, MN-WI Metro Area","Niles, MI Metro Area","Enid, OK Metro Area","Rochester, MN Metro Area","Iowa City, IA Metro Area","Waterloo-Cedar Falls, IA Metro Area","Lansing-East Lansing, MI Metro Area","Utica-Rome, NY Metro Area","Whitewater-Elkhorn, WI Micro Area","Zanesville, OH Micro Area","Monticello, NY Micro Area","Rockford, IL Metro Area","Lexington Park, MD Metro Area","Erie, PA Metro Area","Logan, UT-ID Metro Area","Shawnee, OK Micro Area","Toledo, OH Metro Area","Mankato, MN Metro Area","Cookeville, TN Micro Area","Akron, OH Metro Area","Russellville, AR Micro Area","Fort Smith, AR-OK Metro Area","Morehead City, NC Micro Area","Huntsville, AL Metro Area","Topeka, KS Metro Area","Farmington, MO Micro Area","Rapid City, SD Metro Area","Milwaukee-Waukesha, WI Metro Area","Cumberland, MD-WV Micro Area","Syracuse, NY Metro Area","Gadsden, AL Metro Area","Evansville, IN Metro Area","Searcy, AR Micro Area","Casper, WY Metro Area","Clarksburg, WV Micro Area","Lynchburg, VA Metro Area","Brigham City, UT-ID Micro Area","Chambersburg, PA Metro Area","Great Falls, MT Metro Area","Jamestown-Dunkirk, NY Micro Area","Adrian, MI Micro Area","Sioux City, IA-NE-SD Metro Area","Walla Walla, WA Metro Area","Rocky Mount, NC Metro Area","Warsaw, IN Micro Area","Pittsburgh, PA Metro Area","Binghamton, NY Metro Area","Huntington-Ashland, WV-KY-OH Metro Area","Sanford, NC Micro Area","Brainerd, MN Micro Area","Omaha, NE-IA Metro Area","St. Joseph, MO-KS Metro Area","Wichita, KS Metro Area","Lincoln, NE Metro Area","Quincy, IL-MO Micro Area","Owensboro, KY Metro Area","Columbus, IN Metro Area","Midland, TX Metro Area","Mansfield, OH Metro Area","Chillicothe, OH Micro Area","Hickory-Lenoir-Morganton, NC Metro Area","Weirton-Steubenville, WV-OH Metro Area","Fort Wayne, IN Metro Area","Hermitage, PA Micro Area","Helena, MT Metro Area","Shelby-Kings Mountain, NC Micro Area","Duluth, MN-WI Metro Area","Cincinnati, OH-KY-IN Metro Area","Billings, MT Metro Area","Salem, OH Micro Area","York-Hanover, PA Metro Area","Elizabethtown, KY Metro Area","Decatur, IL Metro Area","Keene, NH Micro Area","St. Louis, MO-IL Metro Area","Lima, OH Metro Area","Dalton, GA Metro Area","Marion, IN Micro Area","Tullahoma-Manchester, TN Micro Area","St. Cloud, MN Metro Area","Racine-Mount Pleasant, WI Metro Area","New Philadelphia-Dover, OH Micro Area","Laurel, MS Micro Area","Williamsport, PA Metro Area","Moses Lake, WA Micro Area","Findlay, OH Micro Area","Auburn, NY Micro Area","Holland, MI Micro Area","North Wilkesboro, NC Micro Area","Canton-Massillon, OH Metro Area","Massena-Ogdensburg, NY Micro Area","Pittsfield, MA Metro Area","Gettysburg, PA Metro Area","Bay City, MI Metro Area","Monroe, MI Metro Area","Des Moines-West Des Moines, IA Metro Area","Putnam, CT Micro Area","Indiana, PA Micro Area","Minot, ND Metro Area","Stevens Point-Plover, WI Micro Area","Bloomsburg-Berwick, PA Micro Area","Ames, IA Metro Area","La Crosse-Onalaska, WI-MN Metro Area","Sandusky, OH Metro Area","Greeneville, TN Micro Area","Fargo, ND-MN Metro Area","Springfield, OH Metro Area","Marquette, MI Micro Area","Fond du Lac, WI Metro Area","Glens Falls, NY Metro Area","Baraboo, WI Micro Area","Parkersburg-Vienna, WV Metro Area","Cullman, AL Micro Area","Grand Island, NE Metro Area","Beaver Dam, WI Micro Area","Oshkosh-Neenah, WI Metro Area","Janesville-Beloit, WI Metro Area","Green Bay, WI Metro Area","Sunbury, PA Micro Area","Springfield, IL Metro Area","Olean, NY Micro Area","Wausau, WI Metro Area","Wheeling, WV-OH Metro Area","Peoria, IL Metro Area","Bloomington, IL Metro Area","Somerset, PA Micro Area","Jefferson, GA Micro Area","Tupelo, MS Micro Area","Albemarle, NC Micro Area","Eau Claire, WI Metro Area","Corning, NY Micro Area","Cape Girardeau, MO-IL Metro Area","DuBois, PA Micro Area","Johnstown, PA Metro Area","Sioux Falls, SD-MN Metro Area","Appleton, WI Metro Area","Davenport-Moline-Rock Island, IA-IL Metro Area","Athens, TN Micro Area","Wooster, OH Micro Area","Grand Forks, ND-MN Metro Area","Faribault-Northfield, MN Micro Area","Frankfort, KY Micro Area","Meadville, PA Micro Area","Torrington, CT Micro Area","Cedar Rapids, IA Metro Area","Richmond-Berea, KY Micro Area","Marinette, WI-MI Micro Area","Pottsville, PA Micro Area","Ottawa, IL Micro Area","Florence-Muscle Shoals, AL Metro Area","Sheboygan, WI Metro Area","Midland, MI Metro Area","Paducah, KY-IL Metro Area","Seneca, SC Micro Area","Dubuque, IA Metro Area","Albertville, AL Micro Area","Mount Airy, NC Micro Area","Talladega-Sylacauga, AL Micro Area","Decatur, AL Metro Area","Jefferson City, MO Metro Area","Wisconsin Rapids-Marshfield, WI Micro Area","Watertown-Fort Atkinson, WI Micro Area","Bismarck, ND Metro Area","Manitowoc, WI Micro Area","Laconia, NH Micro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[0.3116883116883117,0.3088774072334429,0.3013962849595371,0.3011367361120216,0.2949235903741437,0.287157975021451,0.2852233204569512,0.2823449983121413,0.2819271612134729,0.2794935672115483,0.2789940293106568,0.2731640824672005,0.2721837335104869,0.2716493471889155,0.270811003929975,0.2697238144867118,0.2692902319044272,0.2682076507951669,0.2665542249957835,0.2657561201458418,0.2644108439352561,0.264127798377429,0.2621070365989174,0.2615875522221126,0.260069595476294,0.2593198450279811,0.2573276823555655,0.256653229658216,0.2559966792184303,0.2552690252829077,0.2545720555961961,0.2543730009926106,0.2540177701027769,0.2539375569481377,0.2538865658839927,0.2527236091663536,0.2525477249892349,0.2523335841065508,0.2516831053133948,0.2516564057461155,0.251625341882258,0.2515229736706246,0.2509078740255072,0.2505488072588907,0.250018437937901,0.24701330640727,0.2467916784391869,0.246441073512252,0.2455837230778397,0.2436010591350397,0.2430055228527921,0.2426445529932977,0.2415007093689244,0.2409739626479872,0.2400643604183427,0.2398910314619946,0.2393679282091299,0.2391903289288727,0.2391694688387581,0.2391375367526952,0.239070869203981,0.2376022102531186,0.2367467149977345,0.2365535096139861,0.2365019415926379,0.2359632391191261,0.2357797724763596,0.2357241651847461,0.2356348318304482,0.2353308486350421,0.2341205558871174,0.2334541943179559,0.2329557830538009,0.2321503914490647,0.2318705430608886,0.2313781205601786,0.2312767345755093,0.2312217460224271,0.2312036470027897,0.2311617622044565,0.2309754441148086,0.2303713470203857,0.2300712264611182,0.2297994957377837,0.2297795950932482,0.2290766807256466,0.2287431576687775,0.2284784377542718,0.2281233993932469,0.228,0.2279935851746258,0.2278904372897645,0.2274864749325589,0.2274458591794537,0.2273875694795351,0.2273635252377687,0.2271977539919284,0.2271843327461164,0.2268434868578052,0.2262951876583007,0.2262335965797755,0.2258395339195706,0.2255132022638086,0.2253982149313948,0.2253798536859876,0.2251803376217744,0.2250845123325404,0.2249121436938696,0.2249016465102725,0.2247320218489466,0.2239995355115904,0.2238914075703517,0.2238560882879418,0.223669587969671,0.2233623672592769,0.2233395301673145,0.2225111827733278,0.2223062381852552,0.2222440993330216,0.2219047056739682,0.2216199180586196,0.2215638097991039,0.2213717085119412,0.2211129598816787,0.2210081995051186,0.2207492795389049,0.2206746771794811,0.2203856749311295,0.2203253341923015,0.2200382675247869,0.2200331610260411,0.2200150283489309,0.2198470702547421,0.2197125754307733,0.219523500509873,0.2193218225213409,0.2192603634609904,0.2191391741315272,0.2190958818901959,0.2186466500687451,0.2180458158017765,0.2178116435261874,0.2176525718066046,0.21726540325124,0.2172541489507612,0.2172034307646114,0.2170860872778029,0.2168578641980777,0.2168080435784168,0.216700143472023,0.2164026024690737,0.2163779947550116,0.2163420999799237,0.2162064478820298,0.2160843920145191,0.2156570273781456,0.2155896250467417,0.2155629001700939,0.2154985401817025,0.2151624313354741,0.2145455103512837,0.2141212330214811,0.2134590317186533,0.2134242904129614,0.2134240094618569,0.2132508805763193,0.2129234992414939,0.2124746017381802,0.2121614570981359,0.212123418320544,0.211979573845207,0.211643694713022,0.2111140373979457,0.2107691673876324,0.2106053326927696,0.2105644274907868,0.2105343803868991,0.210420609478197,0.2098702620198423,0.2096392464807037,0.2095819812941401,0.2095235649818336,0.2095166575641726,0.2093140269469447,0.209165613147914,0.2087841759811874,0.2087717470569851,0.2085877289560605,0.2083275958859855,0.2083274523641496,0.2080432989392339,0.2078945483200802,0.20777628806742,0.2069473532173034,0.2068559774082209,0.2067942930574319,0.206476986419222,0.2064078251322487,0.2063107728967293,0.2059940221342596,0.2054616384915475,0.2053891742394311,0.205255230125523,0.2048803124637457,0.2045689697646537,0.2044926413632843,0.2039889674840985,0.2039015716993475,0.2035755191474528,0.2034717972446528,0.2033287899060886,0.2032390352401474,0.2028702701743804,0.2020473962460784,0.2020096294745656,0.2019754081838339,0.2019218302047167,0.2018487649643886,0.2016086811670078,0.2015880800091821,0.201579950967039,0.2015560698241829,0.2014388489208633,0.2014122267114753,0.2013199027440083,0.2013102658694823,0.2011921698571917,0.2011350685530754,0.20104009621737,0.200938859629036,0.2004245754245754,0.2003490548184284,0.2002926353438465,0.1999005020125729,0.1996997863864673,0.1995641456182344,0.1991831840833302,0.1991646028166932,0.1991077852928479,0.1990326075346751,0.1990070551345701,0.1989392332171541,0.1988754069251258,0.1983312961683584,0.1981567309018019,0.1980771579626948,0.1980410227832908,0.1979693529654191,0.1979685678787801,0.1976969379743523,0.197556294180984,0.1975495334490402,0.1973290811241778,0.1972677952807373,0.197164268374204,0.197010444680718,0.1969348154969414,0.196931858722797,0.1967633196565031,0.1967476769120801,0.1967020216051905,0.1959156193895871,0.1958885218562586,0.1957221546605623,0.1957121424768911,0.1956072422630694,0.1955599900224495,0.1950892483030252,0.1950518677251254,0.1947728878105709,0.1944437265796614,0.1942152071148145,0.194059107358263,0.193895455334246,0.1933002973240832,0.1931391585760518,0.192968079670674,0.1929461507540681,0.1928486800133669,0.192712984461511,0.1926558497011102,0.1921477907943591,0.191890238010886,0.1917729847245266,0.1915678009899967,0.1915276611064443,0.1915254654108157,0.1914118839876048,0.1913179682255538,0.1911318286316699,0.1911270705432642,0.19084882078035,0.1908242867274017,0.1907568912618076,0.1904562286033676,0.1900940288674612,0.1900052523026864,0.1897829027894093,0.1897308646688299,0.1895368079563515,0.1891427974386913,0.1890322356295858,0.1890177204112886,0.1889538777514846,0.1888924641225304,0.1888684046135328,0.1888473274928635,0.188694719576052,0.1885637178798915,0.188278121587186,0.188034188034188,0.1876978265456847,0.1876770039310724,0.1876638959965671,0.1875428942964131,0.1875027027027027,0.1871085480692021,0.1868808084453668,0.1868209176893614,0.1868176670441676,0.1867474121540736,0.1863680769519802,0.1863181160804432,0.1859931113662457,0.1859504132231405,0.1858749408327485,0.1858347837729281,0.1858185690276727,0.1857423152387181,0.1856745127815743,0.1855447680690399,0.1855165175670948,0.1852546358305801,0.1852029371728753,0.1852001366332329,0.1851603177217274,0.1850097520200613,0.1848771627951439,0.1847971642378889,0.1847841103518635,0.1847257510088178,0.1844973828320694,0.1841480038948393,0.1837888328797127,0.1837483226479797,0.1835210432720806,0.1832332139792265,0.1832324357339178,0.1829603128380065,0.1829128877372151,0.1827119762454635,0.1826638477801268,0.1826391739556033,0.1826073064224092,0.1825185893033117,0.1821300618825318,0.1820074349442379,0.181927868852459,0.1818694671064051,0.1817554988623044,0.1813862270197873,0.1810452183621763,0.1806892962040376,0.1805541459453973,0.1802777865264086,0.1800593047464827,0.1798270893371758,0.1791611912414306,0.1789867743184725,0.1789027188651693,0.1787082605280454,0.1786107103575357,0.1784494894739397,0.1780164564197317,0.1779221237688424,0.1776165176450261,0.1775985663082437,0.1772702649251486,0.1768458533208051,0.1766634160096815,0.1764612311988547,0.1763642705393665,0.1763069433174916,0.1761540738676929,0.1760855614973262,0.1759869006514078,0.1754679315463495,0.1754242486199141,0.1752051713784455,0.1751274865622272,0.1750663129973475,0.1749520501788399,0.1748435186868556,0.1747934985345057,0.1747556914341868,0.1747394236664623,0.1746346410953852,0.1743406347787215,0.1742551534773165,0.1742200891326706,0.1741387024608501,0.173406121087864,0.1731795716639209,0.1731724200198634,0.1731542166057139,0.1730047535651739,0.1729121298679261,0.1728835906169313,0.1728025021176777,0.1727972626176219,0.1727237633044725,0.1725931131412509,0.1724811900025945,0.1723977386099102,0.1723297858699833,0.1722375147463626,0.1719153824064325,0.1717234629415428,0.1716622402090974,0.1716601298680163,0.171564579589061,0.1714243816599863,0.1712182839434437,0.1711139347734011,0.1711007813272673,0.1708273158654838,0.1707161843435289,0.1702730823167514,0.1700692406233278,0.1698540316915151,0.1698131412214968,0.1697242479489517,0.1697240635116387,0.169713051701506,0.1697128425778692,0.1694648607458027,0.1693578207814619,0.1692025318627031,0.1691560113755962,0.1690529760687257,0.1688119477956676,0.1687364720691402,0.1686903895506952,0.1686462284683788,0.1684085285886186,0.1683743815729001,0.1683057223945614,0.1682360326428123,0.1678281161985998,0.1678088534913873,0.1677787830807509,0.1677598766738204,0.1672526942459285,0.1671557994130407,0.1669018722363346,0.166479110986074,0.166301065833957,0.1659433040078201,0.1658628035790371,0.1649651777473219,0.1649260226283725,0.1644483480845889,0.1644378749673941,0.1640003884949981,0.163940568661642,0.1639370004553806,0.1634841057119447,0.1632263854610725,0.1631250287678169,0.1629899928125173,0.1628229225260327,0.1626662061820066,0.162666022699831,0.1622781791400715,0.1618632845031196,0.1612588984638441,0.1606381816194951,0.1604806272593045,0.1602391460680495,0.159700835899692,0.1593550323770316,0.1589869281045752,0.1586430531304565,0.1584276354973198,0.1582249553330286,0.1581566820276498,0.1581311285253773,0.1575532274417033,0.1574798551909378,0.1574611398963731,0.1574485664711229,0.1573115906972354,0.1569576156377008,0.1569298460034221,0.1568971709029967,0.156542856253308,0.1562617610309061,0.1561496269209863,0.1560594102030566,0.1555374806496471,0.1553485934783126,0.1547528837248463,0.1547191661841343,0.1538617386144918,0.1523298242670805,0.1514455834509852,0.1511254470233504,0.1507969143214303,0.1504284772577456,0.15038943033071,0.1503778701282031,0.1500656410946915,0.1495425975480739,0.1483082786966848,0.1476479563678862,0.1473210611505857,0.146810082929633,0.1466474335078364,0.1455217209939813,0.1447873227689742,0.1440843809081561,0.1434869876996449,0.1420164515394869,0.1404682274247492,0.1384837313672063,0.1383066760957554,0.1380092681984939,0.1367689357622243,0.1321287904300335,0.1273799287556811],[72.85616460236997,71.77009832808356,68.8795715506868,68.77928808166736,66.37867712121739,63.37822902023986,62.63072475297169,61.51860989520941,61.35716763052359,60.41688509398345,60.22387559273682,57.97132352303086,57.59254012572457,57.38606602793255,57.06215023697294,56.64208623015723,56.4745602870674,56.0562768303278,55.41743263388597,55.1090640020868,54.58928143908071,54.47991940298939,53.699145367,53.49842902436899,52.91192683123912,52.62224118410393,51.8525171589222,51.5919247624343,51.33824937023659,51.05710128732895,50.78780886451949,50.71089892497275,50.573646202503,50.54265375739983,50.5229520293806,50.07361335929706,50.0056559185458,49.92291700145938,49.67158754834989,49.66127147392415,49.64926913964834,49.60971651023704,49.37205671403499,49.23332190048988,49.0283998756785,47.86728890317289,47.78165715530013,47.64619179429042,47.31493208517892,46.54887814201161,46.31877716147394,46.17930703834268,45.73735321051419,45.53383087174882,45.18238231826937,45.11541215373001,44.9132975639147,44.8446774483178,44.83661760825004,44.82427981367276,44.79852106683153,44.2310663629914,43.90052345070014,43.82587350984705,43.80594885935921,43.59780710365403,43.52691997946877,43.50543465152699,43.47091837933434,43.35346654068909,42.88583836027989,42.62837218226971,42.43579798652085,42.12461392689112,42.01648720071051,41.82622691996898,41.78705379957212,41.76580753740515,41.75881450895421,41.7426312243192,41.67064236923535,41.43723369555713,41.32127428716249,41.21628403258806,41.2085948993523,40.9370055939808,40.80814025914701,40.70585881347969,40.56868047953841,40.52100190439484,40.51852336924496,40.47866949273992,40.32258809641842,40.30689514051736,40.28437339414131,40.27508327400648,40.21103322810692,40.20584757961926,40.07415287780086,39.86230317662421,39.83850585648861,39.6862494663922,39.56016271700405,39.51573436103892,39.50864001482021,39.43155177792013,39.39452717728651,39.32792805653705,39.32387219577663,39.25833328226634,38.97531807483012,38.93354002361105,38.91989349735116,38.84783423348441,38.72913149645494,38.72030779014211,38.40025416240541,38.32106847367891,38.29705950687931,38.16592591172418,38.05589078625813,38.0342118962968,37.95998855196609,37.86001426776046,37.81953736301674,37.7194968786961,37.69067231071337,37.57900875182434,37.55569453305283,37.44477883632064,37.44280580729867,37.43579977440495,37.37090478258978,37.31893919830051,37.24588516953495,37.16796161676842,37.14421530529904,37.09739064596015,37.08066355900183,36.90709112406228,36.67494312890012,36.58446456053407,36.52300305139866,36.3734103785786,36.36906198595731,36.34946569147109,36.30412697378213,36.21594703245613,36.19669753620091,36.15500751491852,36.04004478540958,36.03053695305199,36.01666807018101,35.9642553429168,35.91709587399478,35.75197239653757,35.72592974723326,35.71560389387266,35.69073673316777,35.56087231115023,35.32250879307755,35.15857817706362,34.90271942649525,34.8892962166201,34.8891876638307,34.82229480186896,34.6958024815879,34.52235921918319,34.40136761737455,34.38667034319784,34.33109227716458,34.20131661116111,33.99666968841101,33.86342016206535,33.80011835316174,33.78431356113494,33.77270407860131,33.72874571967447,33.51610462025074,33.42684573937349,33.40471984046228,33.38214917408677,33.37948031305486,33.30118868733708,33.24384514387842,33.09646694259391,33.09166470345041,33.02056450901787,32.92005531036983,32.919999856964,32.81020976751807,32.75273608481706,32.70704315072236,32.38676254398278,32.35145711609524,32.32762375778697,32.20502405939807,32.17830179171735,32.1408031283746,32.01841820708105,31.81271789651733,31.78471944207727,31.73296663898831,31.58810741853868,31.46781204363065,31.43832057430875,31.24371302993806,31.20994538829216,31.0839664779651,31.04389081465294,30.98863619825324,30.9539571413149,30.81147513685874,30.49353632539523,30.47894414786404,30.46572185933627,30.44502060922339,30.41678994730759,30.32402730826226,30.31606751344,30.31292664591653,30.30369954330106,30.25840818894132,30.24812200375519,30.2124502301378,30.20872677223293,30.16309729669018,30.14103471803827,30.10433967825447,30.0652242810296,29.86651716065937,29.83733780409751,29.81553866807558,29.66402772454914,29.58647600561467,29.53406765586061,29.38687322734022,29.37969387017883,29.35774093743865,29.32869404913673,29.31882121267907,29.29261644537173,29.26795549218114,29.0577241051349,28.99027625989049,28.95953117876173,28.94556940941097,28.91787790536858,28.91757456666225,28.81262326610283,28.75828186705586,28.75566968187792,28.6704921744367,28.64681278983981,28.60681246842288,28.54737867109408,28.51815736273217,28.51701493589752,28.45189547035165,28.44585148791542,28.42821136892487,28.12436435523089,28.11389451623889,28.04961420956378,28.04574574117865,28.00521480666048,27.98695767065826,27.80507432543081,27.79063136387798,27.68284019514006,27.55566016556838,27.46736570811774,27.40705249443972,27.34382126518337,27.11386643993501,27.05160628042849,26.98550548178667,26.97703267271768,26.93937230897893,26.88694279214274,26.86486728678244,26.66856547260393,26.56905323500575,26.5237493686137,26.44447127941395,26.42896218813033,26.42811382383726,26.38422867757368,26.3479418725879,26.27602198399954,26.2741835724027,26.16667451680106,26.15719514533664,26.13115514881708,26.01498628626347,25.87504096829225,25.84073982625878,25.7548292905748,25.73472300498386,25.65974413106422,25.50750788760042,25.46478944803002,25.45918111473029,25.43451383742253,25.41078507955845,25.40148906053052,25.39334536504546,25.33438131475518,25.28376539153238,25.17341781247064,25.07916771990023,24.94920568294822,24.94116032251849,24.93609573002868,24.88934356616878,24.87381449531647,24.72152256893768,24.63352942340837,24.61038906724069,24.60913309565883,24.58198828587969,24.4354222334727,24.4161185472459,24.29054449635186,24.27404695474354,24.2448862275966,24.22937049981374,24.22310550993206,24.19364286906335,24.1674456207399,24.11731536593651,24.10640004743783,24.00521520588709,23.98524008063448,23.98415801907594,23.96877294371701,23.91059795653072,23.85936865015314,23.82845912034836,23.82341541089886,23.80086675608365,23.71263075273706,23.5776390848366,23.43886399215971,23.42321180719395,23.33539649046294,23.22418613353347,23.22388543815358,23.11874365747211,23.10041973243264,23.02279233569561,23.00419664741285,22.9946632715536,22.98235041866142,22.94807224501638,22.79795453908947,22.75057442207081,22.71983198658598,22.69726694826221,22.65323234365546,22.51055453277978,22.37879694079566,22.24127712878065,22.18905830020537,22.08227962829955,21.99786349230724,21.90814101028512,21.65085390732163,21.58346337849683,21.55098636105699,21.47585230897696,21.43816125545929,21.37586936073447,21.20855574215454,21.17210786128921,21.05402896190955,21.04709299458274,20.92024518964805,20.75626269316198,20.68577327811278,20.60765390132942,20.57019062077559,20.54804075290335,20.48897565251991,20.46250411070077,20.42438391876079,20.22386666481282,20.2069886264713,20.12234241837603,20.09232686278762,20.06869085994209,20.02454243882765,19.98260846524915,19.96328187433365,19.94867411471598,19.94238863822001,19.90190315804555,19.78830614680508,19.75527821574992,19.74173019134661,19.71028432726272,19.42723240033134,19.33969911958341,19.33693589531117,19.32990253131675,19.27215358602564,19.23636600398731,19.22533911975964,19.19400846242646,19.19198404487826,19.16358566760275,19.11310556830259,19.06986114354229,19.03761752068288,19.01136220668524,18.97571085066656,18.85124661651266,18.77709352396101,18.75343852394368,18.75262313860697,18.7157047953697,18.66153566762537,18.5819044376287,18.5415864132516,18.53650423615669,18.43084372012214,18.38790515712819,18.21670112829062,18.13794157168692,18.0547899859537,18.03899088600575,18.00464465088027,18.0045733887123,18.00031868856296,18.00023788818973,17.90442363737921,17.86306595442059,17.80306602907905,17.7850916251385,17.74528124607742,17.65215368421222,17.62299166806234,17.60518648474116,17.58812369839966,17.49628214812485,17.48308855768629,17.45656029277687,17.42963383894206,17.272024677941,17.2645820284341,17.25296354073007,17.24565855713319,17.04969539342978,17.0122575467005,16.91414615687093,16.75080131774347,16.68200892792051,16.5437783121764,16.5126748712126,16.16585371154438,16.15072510975824,15.96616308695809,15.96211652488013,15.79308221199095,15.76996925863924,15.76859058905353,15.59360288863726,15.4940259456401,15.45486414274516,15.40268947824779,15.3381375141026,15.27758606576665,15.27751517264095,15.12766169426167,14.96735632643056,14.73383601136982,14.49400586368862,14.43313062594319,14.33982806731572,14.13183788894242,13.9982276757456,13.85600098602542,13.72313591787466,13.63990369493977,13.56159292542136,13.5352137525976,13.52534049028877,13.30205332883267,13.2737040454243,13.2664729030762,13.26161483218275,13.20869066816293,13.07192316849459,13.06119364576496,13.04856876820303,12.91167005901854,12.80306158590414,12.75973564689185,12.72487806411256,12.52321696370426,12.45023547688197,12.22006747121298,12.20703981964846,11.87575030732829,11.283855230661,10.94220572100046,10.81851265963636,10.69157547863842,10.54922020634446,10.534133407327,10.529666821476,10.40902898813996,10.20693746739099,9.73002617505316,9.474893415124509,9.348588919032267,9.151159151645325,9.08831530391531,8.653366903686837,8.369612988574389,8.098013060481414,7.867194608033472,7.299014595404498,6.700817814599241,5.934055986100067,5.865646062499009,5.750734761845348,5.271499964090987,3.478658750882534,1.643812142406744]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA<\/th>\n      <th>Year<\/th>\n      <th>Rent-to-Income Ratio<\/th>\n      <th>Rent Burden Index (0‚Äì100)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"scrollY":400,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"CBSA","targets":1},{"name":"Year","targets":2},{"name":"Rent-to-Income Ratio","targets":3},{"name":"Rent Burden Index (0‚Äì100)","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Join building permits and population</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>build_metric <span class="ot">&lt;-</span> PERMITS <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    POPULATION,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span> <span class="ot">=</span> <span class="st">"GEOID"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_per_capita =</span> new_housing_units_permitted <span class="sc">/</span> population,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">permits_per_1000 =</span> permits_per_capita <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Compute long-term averages and growth by metro</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>build_metric <span class="ot">&lt;-</span> build_metric <span class="sc">%&gt;%</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME) <span class="sc">%&gt;%</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_growth    =</span> (population <span class="sc">/</span> <span class="fu">lag</span>(population)) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">permit_growth =</span> (new_housing_units_permitted <span class="sc">/</span> <span class="fu">lag</span>(new_housing_units_permitted)) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean impossible/infinite values from first year or zero-denominators</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_growth    =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(pop_growth),    <span class="cn">NA_real_</span>, pop_growth),</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">permit_growth =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(permit_growth), <span class="cn">NA_real_</span>, permit_growth),</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_diff   =</span> permit_growth <span class="sc">-</span> pop_growth          <span class="co"># &gt;0 =&gt; permits growing faster than population</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Standardize to 0‚Äì100 scales for interpretability</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>permits_range <span class="ot">&lt;-</span> <span class="fu">range</span>(build_metric<span class="sc">$</span>permits_per_1000, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>growth_range  <span class="ot">&lt;-</span> <span class="fu">range</span>(build_metric<span class="sc">$</span>growth_diff,      <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>build_metric <span class="ot">&lt;-</span> build_metric <span class="sc">%&gt;%</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">build_index   =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(permits_per_1000, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">from =</span> permits_range),</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_index  =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(growth_diff,      <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">from =</span> growth_range),</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># optional composite score (tune weights as you like)</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">build_friendliness =</span> <span class="fl">0.6</span> <span class="sc">*</span> build_index <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> growth_index</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>top_build <span class="ot">&lt;-</span> build_metric <span class="sc">%&gt;%</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(build_index)) <span class="sc">%&gt;%</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>bottom_build <span class="ot">&lt;-</span> build_metric <span class="sc">%&gt;%</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(build_index) <span class="sc">%&gt;%</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(top_build, bottom_build) <span class="sc">%&gt;%</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(NAME, year, permits_per_1000, build_index, growth_diff) <span class="sc">%&gt;%</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Year</span><span class="st">`</span> <span class="ot">=</span> year,</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Permits per 1,000 residents</span><span class="st">`</span> <span class="ot">=</span> permits_per_1000,</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Building-Friendliness Index (0‚Äì100)</span><span class="st">`</span> <span class="ot">=</span> build_index,</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Permit Growth ‚Äì Population Growth</span><span class="st">`</span> <span class="ot">=</span> growth_diff</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"CBSAs with Highest and Lowest Building-Friendliness ("</span>, latest_year, <span class="st">")"</span>),</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">scrollY =</span> <span class="dv">400</span>)</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">'Permits per 1,000 residents'</span>, <span class="st">'Building-Friendliness Index (0‚Äì100)'</span>, <span class="st">'Permit Growth ‚Äì Population Growth'</span>), <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-a5022bed603ac439e5c1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a5022bed603ac439e5c1">{"x":{"filter":"none","vertical":false,"caption":"<caption>CBSAs with Highest and Lowest Building-Friendliness (2023)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["Salisbury, MD Metro Area","The Villages, FL Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","The Villages, FL Metro Area","Punta Gorda, FL Metro Area","Punta Gorda, FL Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","The Villages, FL Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","The Villages, FL Metro Area","Wheeling, WV-OH Metro Area","Danville, IL Micro Area","Morgantown, WV Metro Area","Weirton-Steubenville, WV-OH Metro Area","Enid, OK Metro Area","Decatur, IL Metro Area","Johnstown, PA Metro Area","Bay City, MI Metro Area","Williamsport, PA Metro Area","Fairbanks-College, AK Metro Area"],[2023,2021,2023,2022,2022,2021,2021,2014,2022,2019,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[37.73032148639273,33.99489818487444,33.14900447320355,30.62012830240739,28.007362047952,24.78918924467392,23.96850492551894,22.47485789243551,22.38116997566048,22.11146352514726,0.08117062803928658,0.1116507564338748,0.1198727938117433,0.1402204967311097,0.1612305112619512,0.3380024057818294,0.3596902072427832,0.3707317073170732,0.5056598417373407,0.5166596372838465],[100,90.09241787765583,87.84882706112172,81.14140829837578,74.21148519649202,65.67582303488035,63.49909589253929,59.5374483234258,59.28895687964683,58.57360587610739,0.141958793786903,0.2228022085201768,0.2446097799675962,0.2985786400945715,0.3543041703902544,0.8231618929316852,0.8806851390762813,0.9099708611778257,1.267845046906693,1.297020154761727],[13.28779810045208,0.5504936169317201,null,-0.1061028822080347,0.1350306663530307,1.042444948522675,0.5325990999870256,null,-0.06965164443824046,0.3819317224646974,-0.3801768895911155,null,0.5399525992119634,-0.5155021893226091,-0.7842721323446805,0.6278372685455645,-0.4941190343956604,-0.429713890550554,-0.4922154815303512,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA<\/th>\n      <th>Year<\/th>\n      <th>Permits per 1,000 residents<\/th>\n      <th>Building-Friendliness Index (0‚Äì100)<\/th>\n      <th>Permit Growth ‚Äì Population Growth<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"scrollY":400,"columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"CBSA","targets":1},{"name":"Year","targets":2},{"name":"Permits per 1,000 residents","targets":3},{"name":"Building-Friendliness Index (0‚Äì100)","targets":4},{"name":"Permit Growth ‚Äì Population Growth","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(build_metric, <span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">y =</span> new_housing_units_permitted, <span class="at">color =</span> year)) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Population and Housing Permits Over Time"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Color gradient shows evolution from earliest to latest year"</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Total Population"</span>,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"New Housing Units Permitted"</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="housing-growth" class="level3">
<h3 class="anchored" data-anchor-id="housing-growth">Housing Growth</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Key Takeaways">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Key Takeaways
</div>
</div>
<section id="key-takeaways-on-housing-growth-2023" class="level3 callout-body-container callout-body">
<h3 class="anchored" data-anchor-id="key-takeaways-on-housing-growth-2023">üè† Key Takeaways on Housing Growth (2023)</h3>
<p><strong>1.Top-Performing Metro Areas</strong> In 2023, <strong>Salisbury, MD, Myrtle Beach‚ÄìConway‚ÄìNorth Myrtle Beach, SC, and Punta Gorda, FL</strong> led the nation in instantaneous housing growth. - <strong>Salisbury</strong> stands out with a Building-Friendliness Index of <strong>100, reflecting 37.7 permits per 1,000 residents</strong>‚Äîthe highest in the dataset despite its negative 5-year population growth. - This indicates an unusually high pace of new construction relative to its population size, possibly due to post-pandemic migration patterns, second-home development, or local pro-housing policies. - Southern and coastal regions dominate the top rankings‚Äîespecially Florida and South Carolina‚Äîshowing strong residential expansion in smaller or mid-sized metros.</p>
<p><strong>2.Low-Growth and Stagnant Areas</strong> At the other end of the spectrum, <strong>Wheeling (WV-OH), Danville (IL), and Morgantown (WV)</strong> display near-zero growth. - Their Instantaneous Growth values are close to 0 permits per 1,000 residents, signaling minimal new construction activity. - Many of these metros have experienced <strong>negative or stagnant population growth</strong>, limiting the incentive for new development. - Their low Composite Index scores (all under 1) reveal persistent underbuilding relative to both population size and longer-term trends.</p>
<p><strong>3. Broader Interpretation</strong> These results highlight a regional imbalance in housing growth: - Rapid construction is concentrated in <strong>Sun Belt and coastal markets</strong>, while <strong>Midwestern and Appalachian metros</strong> lag behind. - The <strong>rate-based component</strong> (permits relative to 5-year population gains) amplifies these differences: metros with strong in-migration but limited new supply appear under pressure, whereas slower-growing regions that continue permitting aggressively may face oversupply risks. - The <strong>composite index</strong> provides a more nuanced view‚Äîidentifying areas that balance immediate building activity with sustainable long-term growth.</p>
</section>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Clean join (types + uniqueness) ---</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>permits_fix <span class="ot">&lt;-</span> PERMITS <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GEOID =</span> CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GEOID, year, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>pop_fix <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)) <span class="sc">%&gt;%</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GEOID, year, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>hg <span class="ot">&lt;-</span> pop_fix <span class="sc">%&gt;%</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(permits_fix, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(GEOID, year)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5-yr growth (starts in 2014) ---</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>hg <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop_5yrs_ago =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_growth_count =</span> population <span class="sc">-</span> pop_5yrs_ago,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_growth_rate  =</span> pop_growth_count <span class="sc">/</span> pop_5yrs_ago) <span class="sc">%&gt;%</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Two metrics ---</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>hg <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">inst_growth =</span> (new_housing_units_permitted <span class="sc">/</span> <span class="fu">pmax</span>(population, <span class="dv">1</span>)) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_denom  =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_growth_count) <span class="sc">&amp;</span> pop_growth_count <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>                          pop_growth_count, <span class="cn">NA_real_</span>),</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_growth =</span> new_housing_units_permitted <span class="sc">/</span> rate_denom</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Standardize WITHIN YEAR (key change) ---</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>hg <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">inst_index =</span> <span class="fu">rescale</span>(inst_growth, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">from =</span> <span class="fu">range</span>(inst_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_index =</span> <span class="fu">rescale</span>(rate_growth, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">from =</span> <span class="fu">range</span>(rate_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">composite_index =</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(inst_index, rate_index), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Tables for the latest year only ---</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>last_year <span class="ot">&lt;-</span> <span class="fu">max</span>(hg<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>hg_latest <span class="ot">&lt;-</span> <span class="fu">filter</span>(hg, year <span class="sc">==</span> last_year)</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>pretty_tbl <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Metro Area</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">Year         =</span> year,</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">Population   =</span> population,</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">Permits      =</span> new_housing_units_permitted,</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">5-yr Pop Growth (%)</span><span class="st">`</span> <span class="ot">=</span> pop_growth_rate <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Instantaneous Growth (per 1k)</span><span class="st">`</span> <span class="ot">=</span> inst_growth,</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rate-based Growth (/ 5-yr add)</span><span class="st">`</span> <span class="ot">=</span> rate_growth,</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Instantaneous Index (0‚Äì100)</span><span class="st">`</span> <span class="ot">=</span> inst_index,</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rate-based Index (0‚Äì100)</span><span class="st">`</span>    <span class="ot">=</span> rate_index,</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Composite Index (0‚Äì100)</span><span class="st">`</span>     <span class="ot">=</span> composite_index</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatter that works with your current column names</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>fmt_dt <span class="ot">&lt;-</span> <span class="cf">function</span>(dtobj) {</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>  dtobj <span class="sc">|&gt;</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no rownames column</span></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">"Population"</span>,<span class="st">"Permits"</span>), <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># your "5-yr Pop Growth (%)" is already on a 0‚Äì100 scale, so use formatRound (not formatPercentage)</span></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatRound</span>(<span class="st">"5-yr Pop Growth (%)"</span>, <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatRound</span>(<span class="st">"Instantaneous Growth (per 1k)"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatRound</span>(<span class="st">"Rate-based Growth (/ 5-yr add)"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">"Instantaneous Index (0‚Äì100)"</span>,</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Rate-based Index (0‚Äì100)"</span>,</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Composite Index (0‚Äì100)"</span>), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 / Bottom 10 by instantaneous index (within-year scaling)</span></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">&lt;-</span> hg_latest <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(inst_index)) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">pretty_tbl</span>()</span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>bottom10 <span class="ot">&lt;-</span> hg_latest <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(inst_index) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">pretty_tbl</span>()</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a>  top10,</span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,                    <span class="co"># &lt;&lt;&lt; prevents the blank first column</span></span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">options  =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>),</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption  =</span> <span class="fu">paste0</span>(<span class="st">"Instantaneous Housing Growth ‚Äî Top 10 ("</span>, last_year, <span class="st">")"</span>)</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">fmt_dt</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ec096e873ddb214f37df" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ec096e873ddb214f37df">{"x":{"filter":"none","vertical":false,"caption":"<caption>Instantaneous Housing Growth ‚Äî Top 10 (2023)<\/caption>","data":[["Salisbury, MD Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Punta Gorda, FL Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Sherman-Denison, TX Metro Area","Cape Coral-Fort Myers, FL Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Lakeland-Winter Haven, FL Metro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[129710,397478,206134,304818,910108,253507,146907,834573,2473275,818330],[4894,13176,4429,5596,15928,4363,2447,13556,38773,12513],[-68.04015246899739,-14.36708928936908,13.23990704982064,12.33554207543137,13.10044861996545,19.22559587636623,12.02302882415739,12.89852602188241,16.89400882019182,19.2061565981969],[37.73032148639273,33.14900447320355,21.48602365451599,18.35849588935037,17.50121963547183,17.21057012232404,16.65679647668253,16.24303685836949,15.67678482983089,15.29089731526401],[null,null,0.1837683083689473,0.1671845124282983,0.1510937411068319,0.1067296166735977,0.1551975645335194,0.1421724401933948,0.1084717217609275,0.0949054585997406],[100,87.83155288036811,56.8534815220872,48.54644751504609,46.26943399858236,45.49743912878755,44.02655961884864,42.92757170310595,41.42354833039034,40.3985915763358],[null,null,4.439794524860872,4.030597965420196,3.633566532625499,2.538904782948484,3.734826246189417,3.413438061883442,2.581890321993385,2.247149818076693],[100,87.83155288036811,30.64663802347404,26.28852274023314,24.95150026560393,24.01817195586802,23.88069293251903,23.17050488249469,22.00271932619186,21.32287069720624]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Metro Area<\/th>\n      <th>Year<\/th>\n      <th>Population<\/th>\n      <th>Permits<\/th>\n      <th>5-yr Pop Growth (%)<\/th>\n      <th>Instantaneous Growth (per 1k)<\/th>\n      <th>Rate-based Growth (/ 5-yr add)<\/th>\n      <th>Instantaneous Index (0‚Äì100)<\/th>\n      <th>Rate-based Index (0‚Äì100)<\/th>\n      <th>Composite Index (0‚Äì100)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"columnDefs":[{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":8,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":9,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9]},{"name":"Metro Area","targets":0},{"name":"Year","targets":1},{"name":"Population","targets":2},{"name":"Permits","targets":3},{"name":"5-yr Pop Growth (%)","targets":4},{"name":"Instantaneous Growth (per 1k)","targets":5},{"name":"Rate-based Growth (/ 5-yr add)","targets":6},{"name":"Instantaneous Index (0‚Äì100)","targets":7},{"name":"Rate-based Index (0‚Äì100)","targets":8},{"name":"Composite Index (0‚Äì100)","targets":9}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render","options.columnDefs.5.render","options.columnDefs.6.render","options.columnDefs.7.render"],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  bottom10,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">options  =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption  =</span> <span class="fu">paste0</span>(<span class="st">"Instantaneous Housing Growth ‚Äî Bottom 10 ("</span>, last_year, <span class="st">")"</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">fmt_dt</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-acccc18ae5e0199e257c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-acccc18ae5e0199e257c">{"x":{"filter":"none","vertical":false,"caption":"<caption>Instantaneous Housing Growth ‚Äî Bottom 10 (2023)<\/caption>","data":[["Wheeling, WV-OH Metro Area","Danville, IL Micro Area","Morgantown, WV Metro Area","Weirton-Steubenville, WV-OH Metro Area","Enid, OK Metro Area","Decatur, IL Metro Area","Johnstown, PA Metro Area","Bay City, MI Metro Area","Williamsport, PA Metro Area","Fairbanks-College, AK Metro Area"],[2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[135517,71652,141817,114106,62023,100591,130668,102500,112724,94840],[11,8,17,16,10,34,47,38,57,49],[-4.061477905050476,-8.031164563785955,2.24066210555912,-4.644671747559834,0.7177538526493561,-4.924339089422595,-1.793256873149248,-1.668281545294947,-0.9811930675240027,-4.877486133817438],[0.08117062803928658,0.1116507564338748,0.1198727938117433,0.1402204967311097,0.1612305112619512,0.3380024057818294,0.3596902072427832,0.3707317073170732,0.5056598417373407,0.5166596372838465],[null,null,0.00546975546975547,null,0.02262443438914027,null,null,null,null,null],[0,0.08095834221935833,0.1027969154419047,0.1568424980260115,0.2126472480717351,0.6821715015799833,0.7397765231183159,0.7691038779790701,1.127486819809298,1.156703403173661],[null,null,0.04037025187109653,null,0.4636530525787269,null,null,null,null,null],[0,0.08095834221935833,0.07158358365650062,0.1568424980260115,0.338150150325231,0.6821715015799833,0.7397765231183159,0.7691038779790701,1.127486819809298,1.156703403173661]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Metro Area<\/th>\n      <th>Year<\/th>\n      <th>Population<\/th>\n      <th>Permits<\/th>\n      <th>5-yr Pop Growth (%)<\/th>\n      <th>Instantaneous Growth (per 1k)<\/th>\n      <th>Rate-based Growth (/ 5-yr add)<\/th>\n      <th>Instantaneous Index (0‚Äì100)<\/th>\n      <th>Rate-based Index (0‚Äì100)<\/th>\n      <th>Composite Index (0‚Äì100)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"columnDefs":[{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":8,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":9,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9]},{"name":"Metro Area","targets":0},{"name":"Year","targets":1},{"name":"Population","targets":2},{"name":"Permits","targets":3},{"name":"5-yr Pop Growth (%)","targets":4},{"name":"Instantaneous Growth (per 1k)","targets":5},{"name":"Rate-based Growth (/ 5-yr add)","targets":6},{"name":"Instantaneous Index (0‚Äì100)","targets":7},{"name":"Rate-based Index (0‚Äì100)","targets":8},{"name":"Composite Index (0‚Äì100)","targets":9}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render","options.columnDefs.5.render","options.columnDefs.6.render","options.columnDefs.7.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="visualization-the-relationships-between-rent-burden-and-housing-growth" class="level3">
<h3 class="anchored" data-anchor-id="visualization-the-relationships-between-rent-burden-and-housing-growth">Visualization: The Relationships between Rent Burden and Housing Growth</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Key Takeaways">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Key Takeaways
</div>
</div>
<div class="callout-body-container callout-body">
<section id="insights-rent-burden-housing-growth-20092023" class="level3">
<h3 class="anchored" data-anchor-id="insights-rent-burden-housing-growth-20092023">üß© Insights: Rent Burden &amp; Housing Growth (2009‚Äì2023)</h3>
<p><strong>1) Scatter Plot ‚Äî Rent Burden Change vs Housing Growth</strong> - Most CBSAs cluster near the origin, indicating modest housing growth and little rent-burden change. - A few metros (upper-right quadrant) combine <strong>strong housing growth with lower or stable rent burden</strong>, showing the intended YIMBY pattern: additional supply easing rent pressure. - Population-growth coloring reveals that <strong>metros with strong population gains</strong> (yellow points) often experienced only small rent-burden increases or mild declines ‚Üí evidence that new construction helped absorb growth. - The ‚ÄúYIMBY success zone‚Äù lies in the <strong>lower-right quadrant</strong> (high growth + falling burden), occupied by cities such as Gulfport-Biloxi (MS) and Auburn-Opelika (AL).</p>
<p><strong>2) Time Series ‚Äî Rent Burden Trends in High-Housing-Growth CBSAs</strong> - Across high-growth metros, <strong>the average rent-burden index remained flat or declined slightly</strong> between 2009 and 2023. - Despite short-term fluctuations (notably around 2020‚Äì2021), the <strong>aggregate blue line</strong> shows that expanding housing supply correlated with <strong>stabilizing affordability</strong> rather than runaway rent escalation. - This contrasts with slower-building metros, where burden indices rose steadily.</p>
<p><strong>3) Top 10 ‚ÄòYIMBY Success‚Äô CBSAs (Table)</strong> <strong>Avg Housing Growth Index:</strong> Highest in Myrtle Beach (87.8) and Hilton Head Island (55.5) ‚Äì both sustained large permitting rates. <strong>Rent-Burden Change:</strong>Several metros (e.g., Madera CA, Auburn-Opelika AL, Gulfport-Biloxi MS) reduced burdens by &gt; 9 points. <strong>Population Growth:</strong>Most cities expanded &lt; 1%. <strong>Overall YIMBY Score:</strong>Leaders combine high housing growth + declining burden + population gain ‚Üí balanced, not declining metros.</p>
<p><strong>3) Bar Chart ‚Äî Rent Burden Reduction in Top Cities</strong> - <strong>Green bars shorter than red</strong> indicate successful rent-burden reduction. - Metros such as College Station-Bryan (TX), Ocala (FL), and Jacksonville (NC) show pronounced improvement, aligning with high permit issuance and rising population. - Others like Tallahassee (FL) and Valdosta (GA) maintained moderate reductions, suggesting steady‚Äîbut not excessive‚Äîbuilding activity. - Overall, <strong>Southern and Southeastern CBSAs</strong> dominate the YIMBY-success cohort.</p>
</section>
<section id="key-takeaways" class="level3">
<h3 class="anchored" data-anchor-id="key-takeaways">üß† Key Takeaways</h3>
<ul>
<li><strong>High housing-growth metros are not necessarily overbuilt:</strong> they often stabilized rent burdens despite robust population gains.</li>
<li><strong>Permitting activity matters:</strong> CBSAs issuing more permits per capita saw smaller rent-burden increases or even declines.</li>
<li><strong>YIMBY ‚Äúwins‚Äù</strong> occur where policy and supply keep pace with demographic pressure‚Äîmost visible in small-to-mid-size Southern metros.</li>
<li>Conversely, **low-growth or shrinking citie*s** (upper-left quadrant) show rent relief mainly through out-migration rather than healthy expansion.</li>
</ul>
</section>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge rent burden + housing growth data (match on GEOID/year)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>viz_data <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)) <span class="sc">%&gt;%</span>      <span class="co"># Convert to character</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    hg <span class="sc">%&gt;%</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)) <span class="sc">%&gt;%</span>  <span class="co"># Match type</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, composite_index, pop_growth_rate, population),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME) <span class="sc">%&gt;%</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span>  <span class="co"># Make sure data is sorted by year</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> <span class="fu">last</span>(<span class="fu">na.omit</span>(rent_burden_index)) <span class="sc">-</span> <span class="fu">first</span>(<span class="fu">na.omit</span>(rent_burden_index)),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_growth =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop_growth   =</span> (<span class="fu">last</span>(<span class="fu">na.omit</span>(population)) <span class="sc">/</span> <span class="fu">first</span>(<span class="fu">na.omit</span>(population))) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot: Rent burden change vs Housing growth</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(viz_data, <span class="fu">aes</span>(<span class="at">x =</span> avg_housing_growth, <span class="at">y =</span> rent_burden_change, <span class="at">color =</span> total_pop_growth)) <span class="sc">+</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(viz_data<span class="sc">$</span>avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"Population Growth (%)"</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden Change vs. Housing Growth (2009‚Äì2023)"</span>,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"YIMBY success zones: high housing growth + decreasing rent burden"</span>,</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average Housing Growth Index (0‚Äì100)"</span>,</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Change in Rent Burden Index (Final ‚àí Initial)"</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify high-growth CBSAs</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>top_growth_cbsa <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_growth =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(avg_growth, <span class="at">prop =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GEOID)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot rent burden trend for top-growth CBSAs</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">%in%</span> top_growth_cbsa) <span class="sc">%&gt;%</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index, <span class="at">group =</span> NAME)) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="at">color =</span> <span class="st">"#0073C2FF"</span>, <span class="at">linewidth =</span> <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden Trends in High-Housing-Growth CBSAs"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Blue line shows average rent burden trajectory (2009‚Äì2023)"</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent Burden Index (0‚Äì100)"</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>yimby_scores <span class="ot">&lt;-</span> viz_data <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">yimby_score =</span> <span class="fu">scale</span>(avg_housing_growth) <span class="sc">*</span> <span class="fl">0.4</span> <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">scale</span>(<span class="sc">-</span>rent_burden_change) <span class="sc">*</span> <span class="fl">0.4</span> <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">scale</span>(total_pop_growth) <span class="sc">*</span> <span class="fl">0.2</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(yimby_score)) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NAME, avg_housing_growth, rent_burden_change, total_pop_growth, yimby_score)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(yimby_scores, <span class="dv">10</span>),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Top 10 Potential 'YIMBY Success' CBSAs"</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatString</span>(<span class="fu">c</span>(<span class="st">'avg_housing_growth'</span>, <span class="st">'rent_burden_change'</span>, <span class="st">'total_pop_growth'</span>), <span class="at">suffix =</span> <span class="st">'%'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">'avg_housing_growth'</span>, <span class="st">'rent_burden_change'</span>, <span class="st">'total_pop_growth'</span>,<span class="st">'yimby_score'</span>), <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ae51f6163f4de87f412d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ae51f6163f4de87f412d">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 10 Potential 'YIMBY Success' CBSAs<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10"],["Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Gulfport-Biloxi, MS Metro Area","Madera, CA Metro Area","Auburn-Opelika, AL Metro Area","Jacksonville, NC Metro Area","Hilton Head Island-Bluffton-Beaufort, SC Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Elizabethtown, KY Metro Area","Wilmington, NC Metro Area","Killeen-Temple-Fort Hood, TX Metro Area"],[87.83155288036811,35.47965248573012,7.867373152888155,29.18104610827027,39.01670789058987,55.49035682057964,48.17116865479575,44.41781734915624,41.99083248527445,43.28704684689829],[0,-11.51422221058779,-41.21713095420478,-9.985220023636991,-9.429012472004722,-1.216668339434392,-0.2195338742161326,-5.51030122312379,-1.947433926726703,-6.52085204371485],[0,0.7307244236606776,0.05162446108314911,0.4915478757460463,0.2346646327370221,0.07222862546916087,0.2668319082908985,0.1414923740550267,0.3182060503490587,0.1078551067818823],[[2.998753368406582],[2.640990450227314],[2.160860214792057],[1.929421165577108],[1.904273370477364],[1.85946333453612],[1.803180092273291],[1.75846542542442],[1.728296765847833],[1.718135708933189]]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>avg_housing_growth<\/th>\n      <th>rent_burden_change<\/th>\n      <th>total_pop_growth<\/th>\n      <th>yimby_score<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatString(data, \"\", \"%\");\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatString(data, \"\", \"%\");\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatString(data, \"\", \"%\");\n  }"},{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"avg_housing_growth","targets":2},{"name":"rent_burden_change","targets":3},{"name":"total_pop_growth","targets":4},{"name":"yimby_score","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render","options.columnDefs.5.render","options.columnDefs.6.render"],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1) Prepare period summaries &amp; join to housing-growth (hg) ----</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure GEOID types align for joins</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.numeric</span>(GEOID))</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>hg          <span class="ot">&lt;-</span> hg          <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.numeric</span>(GEOID))</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Early (2009‚Äì2012) vs Recent (2021‚Äì2023) rent-burden index, by CBSA</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>rb_period <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">case_when</span>(</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%in%</span> <span class="dv">2009</span><span class="sc">:</span><span class="dv">2012</span> <span class="sc">~</span> <span class="st">"Early (2009‚Äì2012)"</span>,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%in%</span> <span class="dv">2021</span><span class="sc">:</span><span class="dv">2023</span> <span class="sc">~</span> <span class="st">"Recent (2021‚Äì2023)"</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(period)) <span class="sc">%&gt;%</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME, period) <span class="sc">%&gt;%</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rbi =</span> <span class="fu">mean</span>(rent_burden_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>rb_wide <span class="ot">&lt;-</span> rb_period <span class="sc">%&gt;%</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> period, <span class="at">values_from =</span> rbi)</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Population growth over the full study window (first vs last available)</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>pop_span <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)) <span class="sc">%&gt;%</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    hg <span class="sc">%&gt;%</span> </span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)) <span class="sc">%&gt;%</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population)) <span class="sc">%&gt;%</span>  <span class="co"># Remove NAs first</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span>  <span class="co"># Sort by year within each group</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_first =</span> <span class="fu">first</span>(population),</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_last  =</span> <span class="fu">last</span>(population),</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop_growth =</span> (pop_last <span class="sc">/</span> pop_first) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Average housing growth (use your Task 5 composite index)</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>hg_avg <span class="ot">&lt;-</span> hg <span class="sc">%&gt;%</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_housing_growth =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="co"># National baselines to screen candidates</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>early_nat <span class="ot">&lt;-</span> rb_period <span class="sc">%&gt;%</span></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(period, <span class="st">"Early"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">national_early =</span> <span class="fu">mean</span>(rbi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(national_early)</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>avg_growth_nat <span class="ot">&lt;-</span> <span class="fu">mean</span>(hg_avg<span class="sc">$</span>avg_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>viz_base <span class="ot">&lt;-</span> rb_wide <span class="sc">%&gt;%</span></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)) <span class="sc">%&gt;%</span></span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>    pop_span <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)), </span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)</span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>    hg_avg <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.character</span>(GEOID)), </span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"GEOID"</span></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">early  =</span> <span class="st">`</span><span class="at">Early (2009‚Äì2012)</span><span class="st">`</span>,</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">recent =</span> <span class="st">`</span><span class="at">Recent (2021‚Äì2023)</span><span class="st">`</span>)</span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2) Pick YIMBY candidates (high early burden, falling burden, pop up, above-avg build) ----</span></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a>yimby_candidates <span class="ot">&lt;-</span> viz_base <span class="sc">%&gt;%</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta_rbi =</span> recent <span class="sc">-</span> early) <span class="sc">%&gt;%</span></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>    early <span class="sc">&gt;=</span> early_nat,            <span class="co"># high initial rent burden</span></span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>    delta_rbi <span class="sc">&lt;</span> <span class="dv">0</span>,                 <span class="co"># burden fell</span></span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a>    total_pop_growth <span class="sc">&gt;</span> <span class="dv">0</span>,          <span class="co"># population grew</span></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a>    avg_housing_growth <span class="sc">&gt;=</span> avg_growth_nat  <span class="co"># above-average building</span></span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose up to 25 for plotting (largest early burden)</span></span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a>yimby_plot_set <span class="ot">&lt;-</span> yimby_candidates <span class="sc">%&gt;%</span></span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(early, <span class="at">n =</span> <span class="dv">25</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(early) <span class="sc">%&gt;%</span></span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NAME =</span> <span class="fu">fct_inorder</span>(NAME))</span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3) Plot A: Early vs Recent Rent Burden (green lower than red is good) ----</span></span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yimby_plot_set) <span class="sc">+</span></span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> early,  <span class="at">y =</span> NAME), <span class="at">fill =</span> <span class="st">"#d84b4b"</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> recent, <span class="at">y =</span> NAME), <span class="at">fill =</span> <span class="st">"#2ca25f"</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>, <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> early_nat, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(yimby_plot_set<span class="sc">$</span>early, yimby_plot_set<span class="sc">$</span>recent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.06</span>),</span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">02</span>))</span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"YIMBY Success: Rent Burden Reduction in Top Cities"</span>,</span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"high early rent burden - population growth - above-average housing growth"</span>,</span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Rent Burden Index (0‚Äì100)"</span>, <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Red = Early (2009‚Äì2012) ‚Ä¢ Green = Recent (2021‚Äì2023) ‚Ä¢ Dotted line = national early average"</span></span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">8</span>, <span class="dv">24</span>, <span class="dv">28</span>, <span class="dv">8</span>),   <span class="co"># top, right, bottom, left</span></span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span></span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>)           <span class="co"># let long labels/caption spill if needed</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="policy-brief" class="level2">
<h2 class="anchored" data-anchor-id="policy-brief">Policy Brief</h2>
<p><a href="policy_brief.pdf">Download the policy brief (PDF)</a></p>
<strong>You can view the full policy brief here:</strong>
<div style="margin: 0.5rem 0 1rem;">
<p><iframe src="policy_brief.pdf" width="100%" height="800" style="border: 1px solid #ddd;"></iframe></p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/emreozb\.github\.io\/STA9750-2025-FALL");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>